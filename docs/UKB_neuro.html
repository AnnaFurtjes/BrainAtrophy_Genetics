<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Anna Elisabeth Furtjes">
<meta name="dcterms.date" content="2025-02-12">

<title>Brain Atrophy Genetics - UK Biobank: Neuroimaging data preparation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Brain Atrophy Genetics</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Overview</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link active" data-scroll-target="#load-packages">Load packages</a></li>
  <li><a href="#define-functions" id="toc-define-functions" class="nav-link" data-scroll-target="#define-functions">Define functions</a></li>
  <li><a href="#extract-cross-sectionally-processed-neuroimaging-data" id="toc-extract-cross-sectionally-processed-neuroimaging-data" class="nav-link" data-scroll-target="#extract-cross-sectionally-processed-neuroimaging-data">Extract cross-sectionally processed neuroimaging data</a></li>
  <li><a href="#extract-covariates" id="toc-extract-covariates" class="nav-link" data-scroll-target="#extract-covariates">Extract covariates</a></li>
  <li><a href="#correlations-between-phenotypes-of-interest-and-covariates" id="toc-correlations-between-phenotypes-of-interest-and-covariates" class="nav-link" data-scroll-target="#correlations-between-phenotypes-of-interest-and-covariates">Correlations between phenotypes of interest and covariates</a></li>
  <li><a href="#extract-longitudinal-estimates-from-this-cross-sectional-data" id="toc-extract-longitudinal-estimates-from-this-cross-sectional-data" class="nav-link" data-scroll-target="#extract-longitudinal-estimates-from-this-cross-sectional-data">Extract longitudinal estimates from this cross-sectional data</a>
  <ul class="collapse">
  <li><a href="#ukb-initial-scan" id="toc-ukb-initial-scan" class="nav-link" data-scroll-target="#ukb-initial-scan">UKB (initial scan)</a></li>
  <li><a href="#ukb-second-scan" id="toc-ukb-second-scan" class="nav-link" data-scroll-target="#ukb-second-scan">UKB (second scan)</a></li>
  <li><a href="#display-raw-change-in-tbv" id="toc-display-raw-change-in-tbv" class="nav-link" data-scroll-target="#display-raw-change-in-tbv">Display raw change in TBV</a></li>
  <li><a href="#final-distributions-for-longitudinally-observed-atrophic-change-measures" id="toc-final-distributions-for-longitudinally-observed-atrophic-change-measures" class="nav-link" data-scroll-target="#final-distributions-for-longitudinally-observed-atrophic-change-measures">Final distributions for longitudinally-observed atrophic change measures</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">UK Biobank: Neuroimaging data preparation</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Anna Elisabeth Furtjes </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 12, 2025</p>
    </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Doi</div>
    <div class="quarto-title-meta-contents">
      <p class="doi">
        <a href="https://doi.org/10.1101/2024.11.06.622274">10.1101/2024.11.06.622274</a>
      </p>
    </div>
  </div>
  </div>
  

</header>

<hr>
<p>Code displayed here was used to obtain neuroimaging measures: TBV, ICV, LBA (difference, ratio, residual scores).</p>
<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load packages</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="define-functions" class="level2">
<h2 class="anchored" data-anchor-id="define-functions">Define functions</h2>
<p>Functions <code>plot_hist</code> and descriptives expect input data set to contain variables called diff, ratio, resid. <code>plot_hist</code> can also handle diff_stand, ratio_stand, resid_stand and will add an extra x-axis if input are standardised variables.</p>
<p><code>descriptives</code> gives a table of descriptive statistics for TBV, ICV and LBA phenotypes.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>plot_hist <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dat =</span> dat, <span class="at">var =</span> <span class="st">"diff_stand"</span>, <span class="at">split_sample_by =</span> <span class="cn">NULL</span>){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># install packages if they don't already exits</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  packages <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ggplot2"</span>,<span class="st">"stringr"</span>, <span class="st">"tidyr"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="fu">setdiff</span>(packages, <span class="fu">rownames</span>(<span class="fu">installed.packages</span>())))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load packages</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(stringr)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyr)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure input data is data.frame</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">=</span> <span class="fu">as.data.frame</span>(dat)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename for simplicity</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>var <span class="ot">=</span> dat[,var]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate summary stats</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    df_stats <span class="ot">&lt;-</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        dat <span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean =</span> <span class="fu">mean</span>(var, <span class="at">na.rm=</span>T),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">median =</span> <span class="fu">median</span>(var, <span class="at">na.rm=</span>T)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key =</span> Statistic, <span class="at">value =</span> value, mean<span class="sc">:</span>median)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate SD cutoffs</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    insert <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"+2 SDs"</span>, <span class="fu">as.numeric</span>(df_stats[<span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"mean"</span>), <span class="st">"value"</span>]) <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(dat<span class="sc">$</span>var, <span class="at">na.rm=</span>T))</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    df_stats <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_stats, insert)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    insert <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"-2 SDs"</span>, <span class="fu">as.numeric</span>(df_stats[<span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"mean"</span>), <span class="st">"value"</span>]) <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(dat<span class="sc">$</span>var, <span class="at">na.rm=</span>T))</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    df_stats <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_stats, insert)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># format</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    df_stats<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_stats<span class="sc">$</span>value)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># consider one-sided nature of cut-off</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if difference score, we use the upper 2 SD limit</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if ratio or residual score, we use the lower 2 SD limit</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(var <span class="sc">==</span> <span class="st">"diff"</span> <span class="sc">|</span> var <span class="sc">==</span> <span class="st">"diff_stand"</span>){</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>      df_stats<span class="sc">$</span>value[<span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"-2 SDs"</span>)]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>      <span class="co"># changed my mind, no need for median</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>      df_stats <span class="ot">&lt;-</span> df_stats[<span class="sc">-</span><span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"median"</span>),]</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>      <span class="co"># changed my mind, no need for mean either, it's just distracting</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>      df_stats <span class="ot">&lt;-</span> df_stats[<span class="sc">-</span><span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"mean"</span>),]</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(var <span class="sc">==</span> <span class="st">"ratio"</span> <span class="sc">|</span> var <span class="sc">==</span> <span class="st">"resid"</span> <span class="sc">|</span> var <span class="sc">==</span> <span class="st">"ratio_stand"</span> <span class="sc">|</span> var <span class="sc">==</span> <span class="st">"resid_stand"</span>){</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>      df_stats<span class="sc">$</span>value[<span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"+2 SDs"</span>)]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>      <span class="co"># changed my mind, no need for median</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>      df_stats <span class="ot">&lt;-</span> df_stats[<span class="sc">-</span><span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"median"</span>),]</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># changed my mind, no need for mean either, it's just distracting</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>      df_stats <span class="ot">&lt;-</span> df_stats[<span class="sc">-</span><span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"mean"</span>),]</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PLOT</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># different output when there is a "sample" column</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(split_sample_by)){</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>      plot <span class="ot">=</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> var))<span class="sc">+</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">"#56B4E9"</span>)<span class="sc">+</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_vline</span>(<span class="at">data =</span> df_stats, <span class="fu">aes</span>(<span class="at">xintercept =</span> value, <span class="at">color =</span> Statistic), <span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(var)<span class="sc">+</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ylab</span>(<span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_bw</span>()</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(split_sample_by)){</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">names</span>(dat) <span class="sc">==</span> split_sample_by)) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">"You have indicated that you wanted to group plotted values by "</span>, split_sample_by,<span class="st">", but the data contains no such column."</span>)); <span class="cf">break</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># incorporate grouping variable</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(dat)[<span class="fu">which</span>(<span class="fu">names</span>(dat) <span class="sc">==</span> split_sample_by)] <span class="ot">=</span> <span class="st">"split_sample_by"</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure its a factor</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>split_sample_by <span class="ot">=</span> <span class="fu">as.factor</span>(dat<span class="sc">$</span>split_sample_by)</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#56B4E9"</span>,<span class="st">"#009E73"</span>, <span class="st">"#E69F00"</span>) <span class="co"># "#79AC78" #grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">=</span> colors[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>split_sample_by))]</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>      plot <span class="ot">=</span> <span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> var, <span class="at">fill =</span> split_sample_by), <span class="at">bins =</span> <span class="dv">100</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors, <span class="at">name =</span> split_sample_by)<span class="sc">+</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_vline</span>(<span class="at">data =</span> df_stats, <span class="fu">aes</span>(<span class="at">xintercept =</span> value, <span class="at">color =</span> Statistic), <span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(var)<span class="sc">+</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ylab</span>(<span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_bw</span>()</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make second x-axis if we're working with standardised variables</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">grep</span>(<span class="st">"_stand"</span>, var)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>      <span class="co"># calculate mean from original variable</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>      varOr <span class="ot">=</span> <span class="fu">str_remove</span>(var, <span class="st">"_stand"</span>)</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>      mean <span class="ot">=</span> <span class="fu">mean</span>(dat[,varOr], <span class="at">na.rm=</span>T)</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>      sd <span class="ot">=</span> <span class="fu">sd</span>(dat[,varOr], <span class="at">na.rm=</span>T)</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>      <span class="co"># add secondary x axis</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>      plot <span class="ot">=</span> plot<span class="sc">+</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>         <span class="fu">scale_x_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">name =</span> <span class="st">"Raw values"</span>, <span class="at">trans=</span><span class="sc">~</span>.<span class="sc">*</span>sd<span class="sc">+</span>mean))</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">=</span> plot<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>())</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot)</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="co"># this onyl works for the correct naming of the variable names to diff, ratio and resid</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>descriptives <span class="ot">=</span> <span class="cf">function</span>(<span class="at">samples =</span> <span class="fu">c</span>(<span class="st">"HCP"</span>, <span class="st">"Share"</span>, <span class="st">"both"</span>)){</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define statistics to include</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>  stats <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"N"</span>, <span class="st">"TBV: Mean (SD)"</span>, <span class="st">"ICV: Mean (SD)"</span>, <span class="st">"cor(ICV,TBV)"</span>,</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>            <span class="st">"*Difference score*"</span>, <span class="st">"Mean (SD)"</span>, <span class="st">"Median"</span>, <span class="st">"Range"</span>, <span class="st">"Variance"</span>, <span class="st">"Cut off"</span>,</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>            <span class="st">"*Ratio score*"</span>, <span class="st">"Mean (SD)"</span>, <span class="st">"Median"</span>, <span class="st">"Range"</span>, <span class="st">"Variance"</span>, <span class="st">"Cut off"</span>,</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>            <span class="st">"*Residual score*"</span>, <span class="st">"Mean (SD)"</span>, <span class="st">"Median"</span>, <span class="st">"Range"</span>, <span class="st">"Variance"</span>, <span class="st">"Cut off"</span>)</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># object to hold results</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="fu">length</span>(samples)<span class="sc">+</span><span class="dv">1</span>, <span class="at">nrow =</span> <span class="fu">length</span>(stats)))</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(res) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Statistic"</span>, samples)</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>  res<span class="sc">$</span>Statistic <span class="ot">=</span> stats</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> samples){</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pull sample</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">get</span>(i))</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># N</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    N <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>diff))</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>    res[<span class="fu">which</span>(res<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"N"</span>), <span class="fu">which</span>(<span class="fu">names</span>(res) <span class="sc">==</span> i)] <span class="ot">=</span> N</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># TBV: Mean (SD)</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    mean <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dat<span class="sc">$</span>TBV, <span class="at">na.rm =</span> T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    SD <span class="ot">=</span> <span class="fu">signif</span>(<span class="fu">sd</span>(dat<span class="sc">$</span>TBV, <span class="at">na.rm =</span> T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    res[<span class="fu">which</span>(res<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"TBV: Mean (SD)"</span>), <span class="fu">which</span>(<span class="fu">names</span>(res) <span class="sc">==</span> i)] <span class="ot">=</span> <span class="fu">paste0</span>(mean, <span class="st">" ("</span>, SD,<span class="st">")"</span>)</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ICV: Mean (SD)</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    mean <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dat<span class="sc">$</span>ICV, <span class="at">na.rm =</span> T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>    SD <span class="ot">=</span> <span class="fu">signif</span>(<span class="fu">sd</span>(dat<span class="sc">$</span>ICV, <span class="at">na.rm =</span> T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>    res[<span class="fu">which</span>(res<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"ICV: Mean (SD)"</span>), <span class="fu">which</span>(<span class="fu">names</span>(res) <span class="sc">==</span> i)] <span class="ot">=</span> <span class="fu">paste0</span>(mean, <span class="st">" ("</span>, SD,<span class="st">")"</span>)</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ICV TBV correlation</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>    cor <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">cor.test</span>(dat<span class="sc">$</span>ICV, dat<span class="sc">$</span>TBV)<span class="sc">$</span>estimate, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    res[<span class="fu">which</span>(res<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"cor(ICV,TBV)"</span>), <span class="fu">which</span>(<span class="fu">names</span>(res) <span class="sc">==</span> i)] <span class="ot">=</span> cor</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cycle through different scores</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"Difference"</span>, <span class="st">"Ratio"</span>, <span class="st">"Resid"</span>)){</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>        <span class="co"># determine variable that matches the right score</span></span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(j <span class="sc">==</span> <span class="st">"Difference"</span>){</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>          VarName <span class="ot">=</span> <span class="st">"diff"</span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span> <span class="cf">if</span>(j <span class="sc">==</span> <span class="st">"Ratio"</span>){</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>          VarName <span class="ot">=</span> <span class="st">"ratio"</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span> <span class="cf">if</span>(j <span class="sc">==</span> <span class="st">"Resid"</span>){</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>          VarName <span class="ot">=</span> <span class="st">"resid"</span></span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>        dat<span class="sc">$</span>var <span class="ot">=</span> dat[,VarName]</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>        <span class="do">### Calculate mean and SD</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>        mean <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(dat<span class="sc">$</span>var, <span class="at">na.rm=</span>T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>        sd <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">sd</span>(dat<span class="sc">$</span>var, <span class="at">na.rm=</span>T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>        <span class="co"># find correct position in res to store result</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>        index <span class="ot">=</span> <span class="fu">grep</span>(j, res<span class="sc">$</span>Statistic)</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>        Cand <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"Mean"</span>, res<span class="sc">$</span>Statistic)</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>        pos <span class="ot">=</span> Cand[<span class="fu">which</span>(Cand <span class="sc">&gt;</span> index)][<span class="dv">1</span>]</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>        <span class="co"># store mean result</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>        res[pos, <span class="fu">which</span>(<span class="fu">names</span>(res) <span class="sc">==</span> i)] <span class="ot">=</span> <span class="fu">paste0</span>(mean, <span class="st">" ("</span>, sd, <span class="st">")"</span>)</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>        <span class="do">### Calculate median</span></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>        median <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">median</span>(dat<span class="sc">$</span>var, <span class="at">na.rm=</span>T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>        <span class="co">#store median result</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>        Cand <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"Median"</span>, res<span class="sc">$</span>Statistic)</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>        pos <span class="ot">=</span> Cand[<span class="fu">which</span>(Cand <span class="sc">&gt;</span> index)][<span class="dv">1</span>]</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>        res[pos, <span class="fu">which</span>(<span class="fu">names</span>(res) <span class="sc">==</span> i)] <span class="ot">=</span> median</span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>        <span class="do">### Calculate range</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>        min <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">min</span>(dat<span class="sc">$</span>var, <span class="at">na.rm =</span> T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>        max <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">max</span>(dat<span class="sc">$</span>var, <span class="at">na.rm =</span> T), <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>        <span class="co"># store results</span></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>        Cand <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"Range"</span>, res<span class="sc">$</span>Statistic)</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>        pos <span class="ot">=</span> Cand[<span class="fu">which</span>(Cand <span class="sc">&gt;</span> index)][<span class="dv">1</span>]</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>        res[pos, <span class="fu">which</span>(<span class="fu">names</span>(res) <span class="sc">==</span> i)] <span class="ot">=</span> <span class="fu">paste0</span>(min, <span class="st">" to "</span>, max)</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Calculate variance</span></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>        variance <span class="ot">=</span> <span class="fu">signif</span>(<span class="fu">var</span>(dat<span class="sc">$</span>var, <span class="at">na.rm =</span> T), <span class="at">digit =</span> <span class="dv">2</span>)</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>        <span class="co"># store variance result</span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>        Cand <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"Variance"</span>, res<span class="sc">$</span>Statistic)</span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>        pos <span class="ot">=</span> Cand[<span class="fu">which</span>(Cand <span class="sc">&gt;</span> index)][<span class="dv">1</span>]</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>        res[pos, <span class="fu">which</span>(<span class="fu">names</span>(res) <span class="sc">==</span> i)] <span class="ot">=</span> variance</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>        <span class="do">### calculate cut-off</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(j <span class="sc">==</span> <span class="st">"Difference"</span>){</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>          cutOff <span class="ot">=</span> <span class="fu">mean</span>(dat<span class="sc">$</span>var, <span class="at">na.rm =</span> T)<span class="sc">+</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(dat<span class="sc">$</span>var, <span class="at">na.rm =</span> T))</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span>{</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>            cutOff <span class="ot">=</span> <span class="fu">mean</span>(dat<span class="sc">$</span>var, <span class="at">na.rm =</span> T)<span class="sc">-</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(dat<span class="sc">$</span>var, <span class="at">na.rm =</span> T))</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>        <span class="co"># store results</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>        Cand <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"Cut"</span>, res<span class="sc">$</span>Statistic)</span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>        pos <span class="ot">=</span> Cand[<span class="fu">which</span>(Cand <span class="sc">&gt;</span> index)][<span class="dv">1</span>]</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>        res[pos, <span class="fu">which</span>(<span class="fu">names</span>(res) <span class="sc">==</span> i)] <span class="ot">=</span> <span class="fu">round</span>(cutOff, <span class="at">digit =</span> <span class="dv">1</span>)</span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a><span class="co"># define function to make ggplots prettier</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>make_pretty <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">6</span>),</span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">4</span>, <span class="at">colour=</span><span class="st">'#696969'</span>),</span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">colour=</span><span class="st">'#1A1A1A'</span>, <span class="at">size=</span><span class="dv">6</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">colour=</span><span class="st">'#1A1A1A'</span>, <span class="at">size=</span><span class="dv">6</span>),</span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">"bold"</span>, <span class="at">colour=</span><span class="st">'#1A1A1A'</span>, <span class="at">size=</span><span class="dv">6</span>),</span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x.top =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">size=</span><span class="dv">6</span>, <span class="at">hjust=</span><span class="dv">0</span>))</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="extract-cross-sectionally-processed-neuroimaging-data" class="level2">
<h2 class="anchored" data-anchor-id="extract-cross-sectionally-processed-neuroimaging-data">Extract cross-sectionally processed neuroimaging data</h2>
<p>Here we aggregate neuroimaging measures to calculate lifetime atrophy scores (ICV, TBV), in addition to CSF, and T1-scaling factor (N = 46836). This was the phenotypic input data for the GWAS.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># aim is to extract neuroimaging data for UKB from the IDP variables : ICV &amp; TBV</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># also add T1 volumetric scaling factor (field ID 25000) &amp; CSF (field ID: 26527)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># downloaded N = 46836</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="fu">list.files</span>(<span class="at">path =</span> wd, <span class="at">pattern =</span> <span class="st">"RAP_download_08022024_neuro"</span>)))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>, <span class="fu">names</span>(file))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># keep ID, 26515 &amp; 26521</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grepl</span>(<span class="st">"f.eid|f.26515_2.0|26521_2.0|f.25000_2|26527_2"</span>, <span class="fu">names</span>(file))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[, ..Cols]</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># name variables TBV and icv</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.26515"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"TBV"</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.26521"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"ICV"</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.25000"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"T1ScalingFactor"</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.26527"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"CSF"</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="do">#######################</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Quality control: </span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># something must have gone wrong if TBV is larger than ICV - delete</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>delete <span class="ot">=</span> <span class="fu">sum</span>(file<span class="sc">$</span>ICV <span class="sc">-</span> file<span class="sc">$</span>TBV <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="at">na.rm=</span>T)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(delete, <span class="st">" people have larger TBV than ICV, and will therefore be removed from the sample."</span>))</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[file<span class="sc">$</span>ICV <span class="sc">-</span> file<span class="sc">$</span>TBV <span class="sc">&gt;=</span> <span class="dv">0</span>,]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># also a participant has ICV &gt; 5000 which would be 5 times thesize of the smaller brains in the sample - delete </span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="fu">sum</span>(file<span class="sc">$</span>ICV <span class="sc">&gt;</span> <span class="dv">5000000</span>), <span class="st">" people have ICV &gt; 5000000 which is 5 time larger than the average brain in the sample, and will therefore be removed from the sample."</span>))</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[file<span class="sc">$</span>ICV <span class="sc">&lt;=</span> <span class="dv">5000000</span>,]</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="do">### calculate atrophy measures</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co"># convert mm3 estimates to more intuitive cm3 estimates</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>ICV <span class="ot">=</span> file<span class="sc">$</span>ICV<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>TBV <span class="ot">=</span> file<span class="sc">$</span>TBV<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate brain atrophy from single MRI scan</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>diff <span class="ot">=</span> file<span class="sc">$</span>ICV <span class="sc">-</span> file<span class="sc">$</span>TBV</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>ratio <span class="ot">=</span> file<span class="sc">$</span>TBV <span class="sc">/</span> file<span class="sc">$</span>ICV</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(TBV <span class="sc">~</span> ICV, <span class="at">data =</span> file)</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>resid <span class="ot">=</span> <span class="fu">resid</span>(model)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>fileNoMiss <span class="ot">=</span> file[<span class="sc">!</span><span class="fu">is.na</span>(file<span class="sc">$</span>T1ScalingFactor),]</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(TBV <span class="sc">~</span> T1ScalingFactor, <span class="at">data =</span> fileNoMiss)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>fileNoMiss<span class="sc">$</span>residScalingFactor <span class="ot">=</span> <span class="fu">resid</span>(model)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co"># merge back in with file</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">merge</span>(file, fileNoMiss[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"residScalingFactor"</span>)], <span class="at">by =</span> <span class="st">"f.eid"</span>, <span class="at">all.x=</span>T)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co"># standardise variables within one time-point</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>resid_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file<span class="sc">$</span>resid))</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>diff_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file<span class="sc">$</span>diff))</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>ratio_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file<span class="sc">$</span>ratio))</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>TBVstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file<span class="sc">$</span>TBV))</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>ICVstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file<span class="sc">$</span>ICV))</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>residScalingFactor_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file<span class="sc">$</span>residScalingFactor))</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>CSFstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file<span class="sc">$</span>CSF))</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="co"># for regenie to recognise, need to name ID column IID and add FID</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.eid"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"IID"</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>FID <span class="ot">=</span> file<span class="sc">$</span>IID</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="co"># change order of the columns</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>orderedNames <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"FID"</span>, <span class="st">"IID"</span>, <span class="fu">names</span>(file)[<span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">names</span>(file)) <span class="sc">-</span><span class="dv">1</span>)])</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[, ..orderedNames]</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="co"># write file</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(file, <span class="fu">paste0</span>(wd, <span class="st">"/UKB_CrossNeuroIDP.txt"</span>), <span class="at">quote =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">na =</span> <span class="st">"NA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Upon inspection, I noticed that there are two pretty severe outliers: outside of 10 SDs. Remove those here because they had some impossible CSF values which were larger than ICV.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data with all participants</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_CrossNeuroIDP.txt"</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># delete all participants that have difference score larger than 10 SDs</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> dat[<span class="fu">which</span>(dat<span class="sc">$</span>diff_stand <span class="sc">&lt;</span> <span class="dv">10</span>),]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2487172 2595043 are both not available for raw data so I can't look at whether anything has gone wrong with processing</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># there are also two participants with CSFstand &gt; 10 which skew the distribution</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> dat[<span class="fu">which</span>(dat<span class="sc">$</span>CSFstand <span class="sc">&lt;</span> <span class="dv">10</span>),]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># re-calculate reisudal measures after those deletions</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="do">## first delete all residu measures</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>resid <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>residScalingFactor <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="do">## second recaculate all resid measures</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(TBV <span class="sc">~</span> ICV, <span class="at">data =</span> dat)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>resid <span class="ot">=</span> <span class="fu">resid</span>(model)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>fileNoMiss <span class="ot">=</span> dat[<span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>T1ScalingFactor),]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(TBV <span class="sc">~</span> T1ScalingFactor, <span class="at">data =</span> fileNoMiss)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>fileNoMiss<span class="sc">$</span>residScalingFactor <span class="ot">=</span> <span class="fu">resid</span>(model)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># merge back in with file</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">merge</span>(dat, fileNoMiss[,<span class="fu">c</span>(<span class="st">"FID"</span>, <span class="st">"residScalingFactor"</span>)], <span class="at">by =</span> <span class="st">"FID"</span>, <span class="at">all.x=</span>T)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co"># standardise variables within one time-point</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>resid_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(dat<span class="sc">$</span>resid))</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>diff_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(dat<span class="sc">$</span>diff))</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>ratio_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(dat<span class="sc">$</span>ratio))</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>TBVstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(dat<span class="sc">$</span>TBV))</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>ICVstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(dat<span class="sc">$</span>ICV))</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>residScalingFactor_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(dat<span class="sc">$</span>residScalingFactor))</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>CSFstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(dat<span class="sc">$</span>CSF))</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(dat, <span class="st">"UKB_CrossNeuroIDP_noOutliers.txt"</span>, <span class="at">quote =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">na =</span> <span class="st">"NA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="extract-covariates" class="level2">
<h2 class="anchored" data-anchor-id="extract-covariates">Extract covariates</h2>
<p>These are the GWAS covariates.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sex: 31 (676893)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># acquisition site: 54 (676893)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># scanning day: 53 (676893) Day2day: investigating daily variability of MRI measures over half a year, Filevich et al., 2017; but actually studies suggest its mainly the time of day that matters (Identifying predictors of within-person variance in MRI-based brain volume estimates, Karch et al., 2019)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># scanning month: 53</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="do">### scan positions: 25756, 25757, 25758 (670476)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="do">#### extract scanning positions</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>file2 <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="fu">list.files</span>(<span class="at">path =</span> wd, <span class="at">pattern =</span> <span class="st">"RAP_download_08022024_neuro"</span>)))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file2) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>, <span class="fu">names</span>(file2))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file2) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file2), <span class="at">fixed =</span> T)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># keep ID,  &amp; columns of interest</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grepl</span>(<span class="st">"f.eid|f.25756_2|f.25757_2|f.25758_2"</span>, <span class="fu">names</span>(file2))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>file2 <span class="ot">=</span> file2[, ..Cols]</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># change column names</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file2)[<span class="fu">grep</span>(<span class="st">"f.25756_2"</span>, <span class="fu">names</span>(file2))] <span class="ot">=</span> <span class="st">"xCoord"</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file2)[<span class="fu">grep</span>(<span class="st">"f.25757_2"</span>, <span class="fu">names</span>(file2))] <span class="ot">=</span> <span class="st">"yCoord"</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file2)[<span class="fu">grep</span>(<span class="st">"f.25758_2"</span>, <span class="fu">names</span>(file2))] <span class="ot">=</span> <span class="st">"zCoord"</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="do">#### extract sex, site, month, age</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="fu">list.files</span>(<span class="at">path =</span> wd, <span class="at">pattern =</span> <span class="st">"RAP_download_08022024_covariates"</span>)))</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>, <span class="fu">names</span>(file))</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># name variables TBV and icv</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.31"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"sex"</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.54"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"site"</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">#names(file)[grep("f.53", names(file))] = "day"</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co">#names(file)[grep("f.21022", names(file))] = "age_at_recruitment"</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.52"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"birth_month"</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.53"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"date_of_assessment"</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.34"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"birth_year"</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure site is categorical and represented in numbers</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>site[<span class="fu">grep</span>(<span class="st">"Cheadle"</span>, file<span class="sc">$</span>site)] <span class="ot">=</span> <span class="st">"1"</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>site[<span class="fu">grep</span>(<span class="st">"Bristol"</span>, file<span class="sc">$</span>site)] <span class="ot">=</span> <span class="st">"2"</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>site[<span class="fu">grep</span>(<span class="st">"Newcastle"</span>, file<span class="sc">$</span>site)] <span class="ot">=</span> <span class="st">"3"</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>site[<span class="fu">grep</span>(<span class="st">"Reading"</span>, file<span class="sc">$</span>site)] <span class="ot">=</span> <span class="st">"4"</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>site <span class="ot">=</span> <span class="fu">as.factor</span>(file<span class="sc">$</span>site)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="co"># work out assessment month</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>assessmentMonth <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">as.POSIXct</span>(file<span class="sc">$</span>date_of_assessment), <span class="st">"%m"</span>))</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="co"># transform birth_month into numerics</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"January"</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"February"</span>)] <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"March"</span>)] <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"April"</span>)] <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"May"</span>)] <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"June"</span>)] <span class="ot">=</span> <span class="dv">6</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"July"</span>)] <span class="ot">=</span> <span class="dv">7</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"August"</span>)] <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"September"</span>)] <span class="ot">=</span> <span class="dv">9</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"October"</span>)] <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"November"</span>)] <span class="ot">=</span> <span class="dv">11</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_month[<span class="fu">which</span>(file<span class="sc">$</span>birth_month <span class="sc">==</span> <span class="st">"December"</span>)] <span class="ot">=</span> <span class="dv">12</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birthday <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>birth_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="fu">ISOdate</span>(<span class="at">year =</span> file<span class="sc">$</span>birth_year,</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>                    <span class="at">month =</span> file<span class="sc">$</span>birth_month, </span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>                    <span class="at">day =</span> file<span class="sc">$</span>birthday))</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a><span class="do">##### Work out age as the difference between date attended assessment center and birthday (we have month and year)</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>date_of_assessment <span class="ot">=</span> <span class="fu">as.Date</span>(file<span class="sc">$</span>date_of_assessment)</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>age <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(file<span class="sc">$</span>date_of_assessment, file<span class="sc">$</span>birth_date, <span class="at">units =</span> <span class="st">"days"</span>))<span class="sc">/</span>(<span class="fl">365.5</span><span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the two data files</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">merge</span>(file, file2, <span class="at">by =</span> <span class="st">"f.eid"</span>)</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"assessmentMonth"</span>, <span class="st">"site"</span>,<span class="st">"xCoord"</span>, <span class="st">"yCoord"</span>, <span class="st">"zCoord"</span>)]</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a><span class="co"># make sex &amp; assessment month a factor</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>assessmentMonth <span class="ot">=</span> <span class="fu">as.factor</span>(file<span class="sc">$</span>assessmentMonth)</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>sex[<span class="fu">grep</span>(<span class="st">"Female"</span>, file<span class="sc">$</span>sex)] <span class="ot">=</span> <span class="st">"1"</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>sex[<span class="fu">grep</span>(<span class="st">"Male"</span>, file<span class="sc">$</span>sex)] <span class="ot">=</span> <span class="st">"0"</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>sex <span class="ot">=</span> <span class="fu">as.factor</span>(file<span class="sc">$</span>sex)</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a><span class="co"># genetic covariates saved in charleys file</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>genCovar <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">"/Cluster_Filespace/charley_ccace/Charley_UKB_OCT2020/Sample_QC_with_IDs_REM_19July2017.csv"</span>)</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(genCovar)[<span class="fu">which</span>(<span class="fu">names</span>(genCovar) <span class="sc">==</span> <span class="st">"ukb_id"</span>)] <span class="ot">=</span> <span class="st">"f.eid"</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a><span class="co"># store column names of columns of interest</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>covarNames <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"genotyping.array"</span>, <span class="st">"Batch"</span>, <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">40</span>))</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>genCovar <span class="ot">=</span> genCovar[, ..covarNames]</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a><span class="co"># format factor variables</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(genCovar)[<span class="fu">which</span>(<span class="fu">names</span>(genCovar) <span class="sc">==</span> <span class="st">"genotyping.array"</span>)] <span class="ot">=</span> <span class="st">"array"</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>genCovar<span class="sc">$</span>array[<span class="fu">grep</span>(<span class="st">"UKBB"</span>, genCovar<span class="sc">$</span>array)] <span class="ot">=</span> <span class="st">"0"</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>genCovar<span class="sc">$</span>array[<span class="fu">grep</span>(<span class="st">"UKBL"</span>, genCovar<span class="sc">$</span>array)] <span class="ot">=</span> <span class="st">"1"</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>genCovar<span class="sc">$</span>array <span class="ot">=</span> <span class="fu">as.factor</span>(genCovar<span class="sc">$</span>array)</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(genCovar)[<span class="fu">which</span>(<span class="fu">names</span>(genCovar) <span class="sc">==</span> <span class="st">"Batch"</span>)] <span class="ot">=</span> <span class="st">"batch"</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>genCovar<span class="sc">$</span>batch <span class="ot">=</span> <span class="fu">as.factor</span>(genCovar<span class="sc">$</span>batch)</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a><span class="co"># merge in with file</span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">merge</span>(file, genCovar, <span class="at">by =</span> <span class="st">"f.eid"</span>)</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a><span class="co"># for regenie to recognise, need to name ID column IID and add FID</span></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.eid"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"IID"</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>FID <span class="ot">=</span> file<span class="sc">$</span>IID</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a><span class="co"># change order of the columns</span></span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>orderedNames <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"FID"</span>, <span class="st">"IID"</span>, <span class="fu">names</span>(file)[<span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(<span class="fu">names</span>(file)) <span class="sc">-</span><span class="dv">1</span>)])</span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[, ..orderedNames]</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a><span class="co"># write file</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(file, <span class="fu">paste0</span>(wd, <span class="st">"/UKB_covarGWAS.txt"</span>), <span class="at">quote =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">na =</span> <span class="st">"NA"</span>)</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a><span class="co"># 45616 rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="correlations-between-phenotypes-of-interest-and-covariates" class="level2">
<h2 class="anchored" data-anchor-id="correlations-between-phenotypes-of-interest-and-covariates">Correlations between phenotypes of interest and covariates</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">##### this next section of code has been taken from REGENIE_step1_reAnalyse_resid.sh</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># read in pheno file</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>all <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">"/CCACE_Shared/Anna_F/BrainAtrophy/data/UKB_CrossNeuroIDP_noOutliers.txt"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read in fam file that restricts participants</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>fam <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">"/CCACE_Shared/Anna_F/BrainAtrophy/data/geneticQC/ukb_neuroimaging_brainAtrophy_GWASinput.fam"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only fam particiants</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>all <span class="ot">=</span> all[all<span class="sc">$</span>FID <span class="sc">%in%</span> fam<span class="sc">$</span>V1,]</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># read in covar file to keep all non-missing participants</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>covar <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">"/CCACE_Shared/Anna_F/BrainAtrophy/data/UKB_covarGWAS.txt"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>covar <span class="ot">=</span> covar[<span class="fu">complete.cases</span>(covar),]</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># only keep complte covar cases</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>all <span class="ot">=</span> <span class="fu">merge</span>(all, covar, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"IID"</span>, <span class="st">"FID"</span>))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># recalculate resid score</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(TBV <span class="sc">~</span> ICV, <span class="at">data =</span> all)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>all<span class="sc">$</span>resid <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">resid</span>(model))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># standardised (this is the final phenotype modelled in GWAS)</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>all<span class="sc">$</span>resid_stand <span class="ot">=</span> <span class="fu">scale</span>(all<span class="sc">$</span>resid)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co"># standardise some more covariates</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>all<span class="sc">$</span>xCoord_stand <span class="ot">&lt;-</span> <span class="fu">scale</span>(all<span class="sc">$</span>xCoord)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>all<span class="sc">$</span>yCoord_stand <span class="ot">&lt;-</span> <span class="fu">scale</span>(all<span class="sc">$</span>yCoord)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>all<span class="sc">$</span>zCoord_stand <span class="ot">&lt;-</span> <span class="fu">scale</span>(all<span class="sc">$</span>zCoord)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>all<span class="sc">$</span>age_stand <span class="ot">&lt;-</span> <span class="fu">scale</span>(all<span class="sc">$</span>age)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># get all possible combinations between variable names we want to consider (exclude genetic PCs to keep an overview - PCs will be fine)</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>Names <span class="ot">&lt;-</span> <span class="fu">names</span>(all)[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"PC"</span>, <span class="fu">names</span>(all))]</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co"># also exclude ID variables</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>Names <span class="ot">&lt;-</span> Names[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"ID"</span>, Names)] </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co">#only keep stand variables</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>Names <span class="ot">&lt;-</span> Names[<span class="fu">grepl</span>(<span class="st">"stand"</span>, Names)]</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co"># get all combinations of traits</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>traits <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(Names, Names)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co"># transofmr factor into character vectors</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>traits <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">lapply</span>(traits, as.character), <span class="at">stringAsFactors =</span> F)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># delete combinations where trait is paired with itself</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>traits <span class="ot">&lt;-</span> traits[traits<span class="sc">$</span>Var1 <span class="sc">!=</span> traits<span class="sc">$</span>Var2,]</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co"># build data frame to hold output values for the correlations between traits</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>resNames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"predictor"</span>, <span class="st">"outcome"</span>, <span class="st">"assoc"</span>, <span class="st">"se"</span>, <span class="st">"p"</span>) </span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">nrow =</span> <span class="fu">nrow</span>(traits), <span class="at">ncol =</span> <span class="fu">length</span>(resNames)))</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(res) <span class="ot">&lt;-</span> resNames</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>res[,<span class="fu">c</span>(<span class="st">"predictor"</span>, <span class="st">"outcome"</span>)] <span class="ot">&lt;-</span> traits[,<span class="fu">c</span>(<span class="st">"Var1"</span>, <span class="st">"Var2"</span>)]</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="co"># cycle through the three phenos of interest</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(res)){</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract the var names</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    vars <span class="ot">&lt;-</span> res[i, <span class="fu">c</span>(<span class="st">"predictor"</span>, <span class="st">"outcome"</span>)]</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># build model (the way expand.grid arranged the traits meant that all the continious traits of interest are in the second column - so here they are placed as the outcome variable in the model)</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>( <span class="fu">as.character</span>(vars[<span class="dv">2</span>]), <span class="st">" ~ "</span>, <span class="fu">as.character</span>(vars[<span class="dv">1</span>]))), <span class="at">data =</span> all)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get summary of model</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    modR <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># extract and store results</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>    res[i, <span class="st">"assoc"</span>] <span class="ot">&lt;-</span> modR<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>    res[i, <span class="st">"se"</span>] <span class="ot">&lt;-</span> modR<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">2</span>]</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    res[i, <span class="st">"p"</span>] <span class="ot">&lt;-</span> modR<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">4</span>]</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(res, <span class="st">"UKB_covar_assocs.table"</span>, <span class="at">quote =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>, <span class="at">na =</span> <span class="st">"NA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="extract-longitudinal-estimates-from-this-cross-sectional-data" class="level2">
<h2 class="anchored" data-anchor-id="extract-longitudinal-estimates-from-this-cross-sectional-data">Extract longitudinal estimates from this cross-sectional data</h2>
<p>We had planned to longitudinally process UKB data from the initial and second neuroimaging visit. This however was not possible due to missing files for all but ~600 participants from field ID 20263 (missing files were mri/orig/001.mgz that need to be present in the FS output directory to run the longitudinal processing pipeline). We noticed this during the time that UKB stopped data downloads. Hence, we were not given permission to download raw MRI files (field 20253), meaning that, unfortunately, we had to work with tabulated data only, even to extract longitudinal estimates of brain change. For this reason, the output file created here is called: ‘UKB_neuroNoLongProcess.txt’.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># it's aim is to extract neuroimaging data for UKB from the IDP variables </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># keep ID, 26515 &amp; 26521</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grepl</span>(<span class="st">"f.eid|f.26515|26521"</span>, <span class="fu">names</span>(file))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[, ..Cols]</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># melt data to get wave column</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">melt</span>(file, <span class="at">id.vars =</span> <span class="st">"f.eid"</span>, <span class="at">measure.vars =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"f.26515_2.0"</span>, <span class="st">"f.26515_3.0"</span>), <span class="fu">c</span>(<span class="st">"f.26521_2.0"</span>, <span class="st">"f.26521_3.0"</span>)), <span class="at">value.name =</span> <span class="fu">c</span>(<span class="st">"f.26515"</span>, <span class="st">"f.26521"</span>))</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># re-name varibale to wave</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"variable"</span>)] <span class="ot">=</span> <span class="st">"wave"</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># add +1 for correct wave</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>wave <span class="ot">=</span> <span class="fu">as.numeric</span>(file<span class="sc">$</span>wave) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># name variables TBV and icv</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.26515"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"TBV"</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file)[<span class="fu">grep</span>(<span class="st">"f.26521"</span>, <span class="fu">names</span>(file))] <span class="ot">=</span> <span class="st">"ICV"</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># also add T1 volumetric scaling factor (field ID 25000) &amp; CSF (field ID: 26527)</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>more <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co"># R doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(more) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(more))</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(more) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(more), <span class="at">fixed =</span> T)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co"># keep ID, 26515 &amp; 26521</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grepl</span>(<span class="st">"f.eid|f.25000|26527"</span>, <span class="fu">names</span>(more))</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>more <span class="ot">=</span> more[, ..Cols]</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co"># melt data to get wave column</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>more <span class="ot">=</span> <span class="fu">melt</span>(more, <span class="at">id.vars =</span> <span class="st">"f.eid"</span>, <span class="at">measure.vars =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"f.25000_2.0"</span>, <span class="st">"f.25000_3.0"</span>), <span class="fu">c</span>(<span class="st">"f.26527_2.0"</span>, <span class="st">"f.26527_3.0"</span>)), <span class="at">value.name =</span> <span class="fu">c</span>(<span class="st">"f.25000"</span>, <span class="st">"f.26527"</span>))</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co"># re-name varibale to wave</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(more)[<span class="fu">which</span>(<span class="fu">names</span>(more) <span class="sc">==</span> <span class="st">"variable"</span>)] <span class="ot">=</span> <span class="st">"wave"</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co"># add +1 for correct wave</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>more<span class="sc">$</span>wave <span class="ot">=</span> <span class="fu">as.numeric</span>(more<span class="sc">$</span>wave) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co"># name variables TBV and icv</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(more)[<span class="fu">grep</span>(<span class="st">"f.25000"</span>, <span class="fu">names</span>(more))] <span class="ot">=</span> <span class="st">"T1ScalingFactor"</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(more)[<span class="fu">grep</span>(<span class="st">"f.26527"</span>, <span class="fu">names</span>(more))] <span class="ot">=</span> <span class="st">"CSF"</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="co"># merge with other data</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">merge</span>(file, more, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"wave"</span>),<span class="at">all =</span> T)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Quality control: </span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="co"># something must have gone wrong if TBV is larger than ICV - delete</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>delete <span class="ot">=</span> <span class="fu">sum</span>(file<span class="sc">$</span>ICV <span class="sc">-</span> file<span class="sc">$</span>TBV <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="at">na.rm=</span>T)</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(delete, <span class="st">" people have larger TBV than ICV, and will therefore be removed from the sample."</span>)) <span class="co">#17 participants</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[file<span class="sc">$</span>ICV <span class="sc">-</span> file<span class="sc">$</span>TBV <span class="sc">&gt;=</span> <span class="dv">0</span>,]</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="co"># also a participant has ICV &gt; 5000 which would be 5 times thesize of the smaller brains in the sample - delete </span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[file<span class="sc">$</span>ICV <span class="sc">&lt;=</span> <span class="dv">5000000</span>,]</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="do">### calculate atrophy measures</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="co"># convert mm3 estimates to more intuitive cm3 estimates</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>ICV <span class="ot">=</span> file<span class="sc">$</span>ICV<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>TBV <span class="ot">=</span> file<span class="sc">$</span>TBV<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate brain atrophy from single MRI scan</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>diff <span class="ot">=</span> file<span class="sc">$</span>ICV <span class="sc">-</span> file<span class="sc">$</span>TBV</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>ratio <span class="ot">=</span> file<span class="sc">$</span>TBV <span class="sc">/</span> file<span class="sc">$</span>ICV</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="do">##### derive the residuals for each time point separately </span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="do">## first wave (named wave 2 in UKB)</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>file1 <span class="ot">=</span> file[<span class="fu">which</span>(file<span class="sc">$</span>wave <span class="sc">==</span> <span class="dv">2</span>),]</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(TBV <span class="sc">~</span> ICV, <span class="at">data =</span> file1)</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>file1<span class="sc">$</span>resid <span class="ot">=</span> <span class="fu">resid</span>(model)</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="co"># also derive residual model for scaling factor</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a><span class="co"># for some reason here we have an issue with missing data, so delete and re-merge</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>fileNoMiss <span class="ot">=</span> file1[<span class="sc">!</span><span class="fu">is.na</span>(file1<span class="sc">$</span>T1ScalingFactor),]</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(TBV <span class="sc">~</span> T1ScalingFactor, <span class="at">data =</span> fileNoMiss)</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>fileNoMiss<span class="sc">$</span>residScalingFactor <span class="ot">=</span> <span class="fu">resid</span>(model)</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a><span class="co"># merge back in with file</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>file1 <span class="ot">=</span> <span class="fu">merge</span>(file1, fileNoMiss[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"residScalingFactor"</span>)], <span class="at">by =</span> <span class="st">"f.eid"</span>, <span class="at">all.x=</span>T)</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(fileNoMiss<span class="sc">$</span>residScalingFactor))</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(file1<span class="sc">$</span>residScalingFactor))</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a><span class="co"># standardise variables within one time-point</span></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>file1<span class="sc">$</span>resid_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file1<span class="sc">$</span>resid))</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>file1<span class="sc">$</span>diff_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file1<span class="sc">$</span>diff))</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>file1<span class="sc">$</span>ratio_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file1<span class="sc">$</span>ratio))</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>file1<span class="sc">$</span>TBVstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file1<span class="sc">$</span>TBV))</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>file1<span class="sc">$</span>ICVstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file1<span class="sc">$</span>ICV))</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>file1<span class="sc">$</span>residScalingFactor_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file1<span class="sc">$</span>residScalingFactor))</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>file1<span class="sc">$</span>CSFstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file1<span class="sc">$</span>CSF))</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a><span class="co"># wave 4</span></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>file3 <span class="ot">=</span> file[<span class="fu">which</span>(file<span class="sc">$</span>wave <span class="sc">==</span> <span class="dv">3</span>),]</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(TBV <span class="sc">~</span> ICV, <span class="at">data =</span> file3)</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>file3<span class="sc">$</span>resid <span class="ot">=</span> <span class="fu">resid</span>(model)</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a><span class="co"># also derive residual model for scaling factor</span></span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a><span class="co"># for some reason here we have an issue with missing data, so delete and re-merge</span></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>fileNoMiss <span class="ot">=</span> file3[<span class="sc">!</span><span class="fu">is.na</span>(file3<span class="sc">$</span>T1ScalingFactor),]</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(TBV <span class="sc">~</span> T1ScalingFactor, <span class="at">data =</span> fileNoMiss)</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>fileNoMiss<span class="sc">$</span>residScalingFactor <span class="ot">=</span> <span class="fu">resid</span>(model)</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a><span class="co"># merge back in with file</span></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>file3 <span class="ot">=</span> <span class="fu">merge</span>(file3, fileNoMiss[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"residScalingFactor"</span>)], <span class="at">by =</span> <span class="st">"f.eid"</span>, <span class="at">all.x=</span>T)</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(fileNoMiss<span class="sc">$</span>residScalingFactor))</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(file3<span class="sc">$</span>residScalingFactor))</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a><span class="co"># standardise variables within one time-point</span></span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>file3<span class="sc">$</span>resid_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file3<span class="sc">$</span>resid))</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>file3<span class="sc">$</span>diff_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file3<span class="sc">$</span>diff))</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>file3<span class="sc">$</span>ratio_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file3<span class="sc">$</span>ratio))</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>file3<span class="sc">$</span>TBVstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file3<span class="sc">$</span>TBV))</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>file3<span class="sc">$</span>ICVstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file3<span class="sc">$</span>ICV))</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>file3<span class="sc">$</span>residScalingFactor_stand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file3<span class="sc">$</span>residScalingFactor))</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>file3<span class="sc">$</span>CSFstand <span class="ot">=</span> <span class="fu">as.vector</span>(<span class="fu">scale</span>(file3<span class="sc">$</span>CSF))</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a><span class="co">#merge the two waves back together</span></span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">rbind</span>(file1, file3)</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a><span class="co"># only keep participants that have both measurement points</span></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[file<span class="sc">$</span>f.eid <span class="sc">%in%</span> file<span class="sc">$</span>f.eid[<span class="fu">duplicated</span>(file<span class="sc">$</span>f.eid)],]</span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a><span class="co"># store as txt file</span></span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"wave"</span>, <span class="st">"ICV"</span>, <span class="st">"TBV"</span>, <span class="st">"CSF"</span>,  <span class="st">"T1ScalingFactor"</span>,<span class="st">"diff"</span>, <span class="st">"ratio"</span>, <span class="st">"resid"</span>, <span class="st">"ICVstand"</span>, <span class="st">"TBVstand"</span>, <span class="st">"CSFstand"</span>, <span class="st">"resid_stand"</span>, <span class="st">"diff_stand"</span>, <span class="st">"ratio_stand"</span>, <span class="st">"residScalingFactor_stand"</span>)], <span class="fu">paste0</span>(wd, <span class="st">"/UKB_crossNeuroWave2_3.txt"</span>), <span class="at">quote =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a><span class="co"># make wide format </span></span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">=</span> <span class="fu">reshape</span>(file[, <span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"wave"</span>, <span class="st">"TBV"</span>)], <span class="at">idvar =</span> <span class="st">"f.eid"</span>, <span class="at">timevar =</span> <span class="st">"wave"</span>, <span class="at">direction =</span> <span class="st">"wide"</span>)</span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a><span class="do">#### Difference score </span></span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: calculate difference in TBV between wave 2 and wave 5</span></span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>TBVdiff_2to3 <span class="ot">=</span> temp<span class="sc">$</span>TBV<span class="fl">.2</span> <span class="sc">-</span> temp<span class="sc">$</span>TBV<span class="fl">.3</span></span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a><span class="do">###### Ratio score</span></span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: calculate difference in TBV between wave 2 and wave 5</span></span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>TBVratio_3to2 <span class="ot">=</span> temp<span class="sc">$</span>TBV<span class="fl">.3</span> <span class="sc">/</span> temp<span class="sc">$</span>TBV<span class="fl">.2</span></span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a><span class="do">###### Resid score</span></span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a><span class="co"># remove missing because results with missing produces weird dimensions</span></span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a><span class="co">#temp = temp[!is.na(temp$TBV.2),]</span></span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a><span class="co">#temp = temp[!is.na(temp$TBV.3),] </span></span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: calculate difference in TBV between wave 2 and wave 5</span></span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">lm</span>(TBV<span class="fl">.3</span> <span class="sc">~</span> TBV<span class="fl">.2</span>, <span class="at">data =</span> temp)</span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>TBVresid_2to3 <span class="ot">=</span> <span class="fu">resid</span>(model)</span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a><span class="co"># standardise variables</span></span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>TBV<span class="fl">.2</span>_stand <span class="ot">=</span> <span class="fu">scale</span>(temp<span class="sc">$</span>TBV<span class="fl">.2</span>)</span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>TBV<span class="fl">.3</span>_stand <span class="ot">=</span> <span class="fu">scale</span>(temp<span class="sc">$</span>TBV<span class="fl">.3</span>)</span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>TBVdiff_2to3_stand <span class="ot">=</span> <span class="fu">scale</span>(temp<span class="sc">$</span>TBVdiff_2to3)</span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>TBVratio_3to2_stand <span class="ot">=</span> <span class="fu">scale</span>(temp<span class="sc">$</span>TBVratio_3to2)</span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>TBVresid_2to3_stand <span class="ot">=</span> <span class="fu">scale</span>(temp<span class="sc">$</span>TBVresid_2to3)</span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a><span class="co"># no need to keep TBV.2 and TBV.3</span></span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">=</span> temp[, <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="sc">-</span><span class="dv">3</span>)]</span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a><span class="co"># merge back in with neuro</span></span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">=</span> <span class="fu">merge</span>(neuro, temp, <span class="at">by =</span> <span class="st">"f.eid"</span>)</span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a><span class="co"># store as txt file</span></span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(temp, <span class="fu">paste0</span>(wd, <span class="st">"/UKB_neuroNoLongProcess.txt"</span>), <span class="at">quote =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="ukb-initial-scan" class="level3">
<h3 class="anchored" data-anchor-id="ukb-initial-scan">UKB (initial scan)</h3>
<p>Shown in Supplementary Figure 3: Distributions of TBV, ICV, and lifetime brain atrophy estimated with the residual, ratio, and difference method. Histograms are coloured by age groups.</p>
<div class="cell" data-fig.dim="[20,8]">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>UKB <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(out, <span class="st">"/UKB_CrossNeuroIDP_noOutliers.txt"</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>age <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(out, <span class="st">"/UKB_covarGWAS.txt"</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>UKB <span class="ot">=</span> <span class="fu">merge</span>(UKB, age[,<span class="fu">c</span>(<span class="st">"FID"</span>, <span class="st">"age"</span>)], <span class="at">by =</span> <span class="st">"FID"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>UKB<span class="sc">$</span>Sample <span class="ot">=</span> <span class="st">"UKB"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(UKB)[<span class="fu">which</span>(<span class="fu">names</span>(UKB) <span class="sc">==</span> <span class="st">"IID"</span>)] <span class="ot">=</span> <span class="st">"ID"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(UKB)[<span class="fu">which</span>(<span class="fu">names</span>(UKB) <span class="sc">==</span> <span class="st">"age"</span>)] <span class="ot">=</span> <span class="st">"Age"</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>UKB<span class="sc">$</span>Age <span class="ot">&lt;-</span> UKB<span class="sc">$</span>Age <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># make age groups</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>UKB<span class="sc">$</span>Age_group <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>UKB<span class="sc">$</span>Age_group[UKB<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">55</span>] <span class="ot">&lt;-</span> <span class="st">"55 years and under"</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>UKB<span class="sc">$</span>Age_group[UKB<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">55</span> <span class="sc">&amp;</span> UKB<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">60</span>] <span class="ot">&lt;-</span> <span class="st">"55 - 59"</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>UKB<span class="sc">$</span>Age_group[UKB<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> UKB<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">65</span>] <span class="ot">&lt;-</span> <span class="st">"60 - 64"</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>UKB<span class="sc">$</span>Age_group[UKB<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">&amp;</span> UKB<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">70</span>] <span class="ot">&lt;-</span> <span class="st">"65 - 69"</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>UKB<span class="sc">$</span>Age_group[UKB<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">70</span> <span class="sc">&amp;</span> UKB<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">75</span>] <span class="ot">&lt;-</span> <span class="st">"70 - 74"</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>UKB<span class="sc">$</span>Age_group[UKB<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">75</span> <span class="sc">&amp;</span> UKB<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">80</span>] <span class="ot">&lt;-</span> <span class="st">"75 - 79"</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>UKB<span class="sc">$</span>Age_group[UKB<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">80</span>] <span class="ot">&lt;-</span> <span class="st">"80 years and over"</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">=</span><span class="fu">ggplot</span>(UKB, <span class="fu">aes</span>(<span class="at">x=</span>TBV, <span class="at">fill=</span>Age_group)) <span class="sc">+</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Age groups"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#292f56"</span>, <span class="st">"#1e4572"</span>, <span class="st">"#005c8b"</span>, <span class="st">"#008ba0"</span>, <span class="st">"#00bca1"</span>,<span class="st">"#69e882"</span>, <span class="st">"#acfa70"</span>))<span class="sc">+</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"TBV"</span>)<span class="sc">+</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">=</span><span class="fu">ggplot</span>(UKB, <span class="fu">aes</span>(<span class="at">x=</span>ICV, <span class="at">fill=</span>Age_group)) <span class="sc">+</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Age groups"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#292f56"</span>, <span class="st">"#1e4572"</span>, <span class="st">"#005c8b"</span>, <span class="st">"#008ba0"</span>, <span class="st">"#00bca1"</span>,<span class="st">"#69e882"</span>, <span class="st">"#acfa70"</span>))<span class="sc">+</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"ICV"</span>)<span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>p3<span class="ot">=</span><span class="fu">ggplot</span>(UKB, <span class="fu">aes</span>(<span class="at">x=</span>resid_stand, <span class="at">fill=</span>Age_group)) <span class="sc">+</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Age groups"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#292f56"</span>, <span class="st">"#1e4572"</span>, <span class="st">"#005c8b"</span>, <span class="st">"#008ba0"</span>, <span class="st">"#00bca1"</span>,<span class="st">"#69e882"</span>, <span class="st">"#acfa70"</span>))<span class="sc">+</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Residual score"</span>)<span class="sc">+</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>p4<span class="ot">=</span><span class="fu">ggplot</span>(UKB, <span class="fu">aes</span>(<span class="at">x=</span>ratio_stand, <span class="at">fill=</span>Age_group)) <span class="sc">+</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Age groups"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#292f56"</span>, <span class="st">"#1e4572"</span>, <span class="st">"#005c8b"</span>, <span class="st">"#008ba0"</span>, <span class="st">"#00bca1"</span>,<span class="st">"#69e882"</span>, <span class="st">"#acfa70"</span>))<span class="sc">+</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Ratio score"</span>)<span class="sc">+</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>p5<span class="ot">=</span><span class="fu">ggplot</span>(UKB, <span class="fu">aes</span>(<span class="at">x=</span>diff_stand, <span class="at">fill=</span>Age_group)) <span class="sc">+</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Age groups"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#292f56"</span>, <span class="st">"#1e4572"</span>, <span class="st">"#005c8b"</span>, <span class="st">"#008ba0"</span>, <span class="st">"#00bca1"</span>,<span class="st">"#69e882"</span>, <span class="st">"#acfa70"</span>))<span class="sc">+</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Difference score"</span>)<span class="sc">+</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>pUKB <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(p1,p2,p3,p4,p5, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">common.legend =</span> T, <span class="at">legend =</span> <span class="st">"bottom"</span>)</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="co"># add title</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>pUKB <span class="ot">&lt;-</span> <span class="fu">annotate_figure</span>(pUKB, <span class="at">top =</span> <span class="fu">text_grob</span>(<span class="st">"UKB (inital neuroimaging visit)"</span>,<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(paste0(out,"phenotypic/UKB_disttributions.jpg"), bg = "white",plot = pUKB, width = 30, height = 10, units = "cm", dpi = 300)</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>pUKB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="UKB_neuro_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="1920"></p>
</div>
</div>
</section>
<section id="ukb-second-scan" class="level3">
<h3 class="anchored" data-anchor-id="ukb-second-scan">UKB (second scan)</h3>
<p>Shown in Supplementary Figure 3: Distributions of TBV, ICV, and lifetime brain atrophy estimated with the residual, ratio, and difference method. Histograms are coloured by age groups.</p>
<div class="cell" data-fig.dim="[20,8]">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>UKB <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(out, <span class="st">"/UKB_neuroNoLongProcess.txt"</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(UKB)[<span class="fu">grepl</span>(<span class="st">"f.eid"</span>, <span class="fu">names</span>(UKB))] <span class="ot">&lt;-</span> <span class="st">"FID"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># restrict to second neuroimaging visit (i.e., third visit altogether)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>UKB3 <span class="ot">=</span> UKB[UKB<span class="sc">$</span>wave <span class="sc">==</span> <span class="dv">3</span>,]</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add age info</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>age <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(out, <span class="st">"/UKB_covarGWAS.txt"</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>UKB3 <span class="ot">=</span> <span class="fu">merge</span>(UKB3, age[,<span class="fu">c</span>(<span class="st">"FID"</span>, <span class="st">"age"</span>)], <span class="at">by =</span> <span class="st">"FID"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(UKB3)[<span class="fu">which</span>(<span class="fu">names</span>(UKB3) <span class="sc">==</span> <span class="st">"age.x"</span>)] <span class="ot">=</span> <span class="st">"Age"</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>UKB3<span class="sc">$</span>Age <span class="ot">&lt;-</span> UKB3<span class="sc">$</span>Age <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="do">####################################################</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># make age groups</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>UKB3<span class="sc">$</span>Age_group <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>UKB3<span class="sc">$</span>Age_group[UKB3<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">55</span>] <span class="ot">&lt;-</span> <span class="st">"55 years and under"</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>UKB3<span class="sc">$</span>Age_group[UKB3<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">55</span> <span class="sc">&amp;</span> UKB3<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">60</span>] <span class="ot">&lt;-</span> <span class="st">"55 - 59"</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>UKB3<span class="sc">$</span>Age_group[UKB3<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">&amp;</span> UKB3<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">65</span>] <span class="ot">&lt;-</span> <span class="st">"60 - 64"</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>UKB3<span class="sc">$</span>Age_group[UKB3<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">65</span> <span class="sc">&amp;</span> UKB3<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">70</span>] <span class="ot">&lt;-</span> <span class="st">"65 - 69"</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>UKB3<span class="sc">$</span>Age_group[UKB3<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">70</span> <span class="sc">&amp;</span> UKB3<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">75</span>] <span class="ot">&lt;-</span> <span class="st">"70 - 74"</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>UKB3<span class="sc">$</span>Age_group[UKB3<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">75</span> <span class="sc">&amp;</span> UKB3<span class="sc">$</span>Age <span class="sc">&lt;</span> <span class="dv">80</span>] <span class="ot">&lt;-</span> <span class="st">"75 - 79"</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>UKB3<span class="sc">$</span>Age_group[UKB3<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">80</span>] <span class="ot">&lt;-</span> <span class="st">"80 years and over"</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">=</span><span class="fu">ggplot</span>(UKB3, <span class="fu">aes</span>(<span class="at">x=</span>TBV, <span class="at">fill=</span>Age_group)) <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Age groups"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#292f56"</span>, <span class="st">"#1e4572"</span>, <span class="st">"#005c8b"</span>, <span class="st">"#008ba0"</span>, <span class="st">"#00bca1"</span>,<span class="st">"#69e882"</span>, <span class="st">"#acfa70"</span>))<span class="sc">+</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"TBV"</span>)<span class="sc">+</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">=</span><span class="fu">ggplot</span>(UKB3, <span class="fu">aes</span>(<span class="at">x=</span>ICV, <span class="at">fill=</span>Age_group)) <span class="sc">+</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Age groups"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#292f56"</span>, <span class="st">"#1e4572"</span>, <span class="st">"#005c8b"</span>, <span class="st">"#008ba0"</span>, <span class="st">"#00bca1"</span>,<span class="st">"#69e882"</span>, <span class="st">"#acfa70"</span>))<span class="sc">+</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"ICV"</span>)<span class="sc">+</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>p3<span class="ot">=</span><span class="fu">ggplot</span>(UKB3, <span class="fu">aes</span>(<span class="at">x=</span>resid_stand, <span class="at">fill=</span>Age_group)) <span class="sc">+</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Age groups"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#292f56"</span>, <span class="st">"#1e4572"</span>, <span class="st">"#005c8b"</span>, <span class="st">"#008ba0"</span>, <span class="st">"#00bca1"</span>,<span class="st">"#69e882"</span>, <span class="st">"#acfa70"</span>))<span class="sc">+</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Residual score"</span>)<span class="sc">+</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>p4<span class="ot">=</span><span class="fu">ggplot</span>(UKB3, <span class="fu">aes</span>(<span class="at">x=</span>ratio_stand, <span class="at">fill=</span>Age_group)) <span class="sc">+</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Age groups"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#292f56"</span>, <span class="st">"#1e4572"</span>, <span class="st">"#005c8b"</span>, <span class="st">"#008ba0"</span>, <span class="st">"#00bca1"</span>,<span class="st">"#69e882"</span>, <span class="st">"#acfa70"</span>))<span class="sc">+</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Ratio score"</span>)<span class="sc">+</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>p5<span class="ot">=</span><span class="fu">ggplot</span>(UKB3, <span class="fu">aes</span>(<span class="at">x=</span>diff_stand, <span class="at">fill=</span>Age_group)) <span class="sc">+</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Age groups"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#292f56"</span>, <span class="st">"#1e4572"</span>, <span class="st">"#005c8b"</span>, <span class="st">"#008ba0"</span>, <span class="st">"#00bca1"</span>,<span class="st">"#69e882"</span>, <span class="st">"#acfa70"</span>))<span class="sc">+</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Difference score"</span>)<span class="sc">+</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>pUKB3 <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(p1,p2,p3,p4,p5, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">common.legend =</span> T, <span class="at">legend =</span> <span class="st">"bottom"</span>)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="co"># add title</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>pUKB3 <span class="ot">&lt;-</span> <span class="fu">annotate_figure</span>(pUKB3, <span class="at">top =</span> <span class="fu">text_grob</span>(<span class="st">"UKB (second neuroimaging visit)"</span>,<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(paste0(out,"phenotypic/UKB3_disttributions.jpg"), bg = "white",plot = pUKB3, width = 30, height = 10, units = "cm", dpi = 300)</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>pUKB3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="UKB_neuro_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="1920"></p>
</div>
</div>
</section>
<section id="display-raw-change-in-tbv" class="level3">
<h3 class="anchored" data-anchor-id="display-raw-change-in-tbv">Display raw change in TBV</h3>
<div class="cell" data-fig.dim="[5,5]">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in UKB neuro data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>UKB <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(out, <span class="st">"/UKB_neuroNoLongProcess.txt"</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">=</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> UKB, <span class="fu">aes</span>(<span class="at">x =</span> wave, <span class="at">y =</span> TBV, <span class="at">group =</span> f.eid),<span class="at">color =</span> <span class="st">"#82A0D8"</span>, <span class="at">size =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> UKB, <span class="fu">aes</span>(<span class="at">x =</span> wave, <span class="at">y =</span> TBV, <span class="at">group =</span> f.eid), <span class="at">color =</span> <span class="st">"#8DDFCB"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">bquote</span>(<span class="st">'TBV in '</span><span class="sc">~</span>mm<span class="sc">^</span><span class="dv">3</span>))<span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Assessment visit"</span>)<span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">15</span>),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.margin=</span><span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="st">"cm"</span>),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span><span class="dv">15</span>),</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span><span class="dv">15</span>),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_blank</span>())</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># get average measures</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>mean2 <span class="ot">=</span> <span class="fu">mean</span>(UKB<span class="sc">$</span>TBV[<span class="fu">which</span>(UKB<span class="sc">$</span>wave <span class="sc">==</span> <span class="dv">2</span>)],  <span class="at">na.rm=</span>T)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>label2 <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"Mean = "</span>, <span class="fu">round</span>(mean2, <span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>mean3 <span class="ot">=</span> <span class="fu">mean</span>(UKB<span class="sc">$</span>TBV[<span class="fu">which</span>(UKB<span class="sc">$</span>wave <span class="sc">==</span> <span class="dv">3</span>)],  <span class="at">na.rm=</span>T)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>label3 <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"Mean = "</span>, <span class="fu">round</span>(mean3, <span class="at">digits =</span> <span class="dv">2</span>))</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>avg <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="fu">c</span>(mean2,mean3),</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">label =</span> <span class="fu">c</span>(label2, label3))</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>avg<span class="sc">$</span>yLabel <span class="ot">=</span> <span class="fu">min</span>(UKB<span class="sc">$</span>TBV, <span class="at">na.rm=</span>T)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>plot<span class="ot">=</span>plot <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> avg, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y), <span class="at">shape =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> avg, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y), <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_text(data = avg, aes(x=x,y=yLabel, label = label), angle = 90, color = "red", vjust = 0, hjust = 0)</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.05</span>, <span class="at">y =</span> <span class="fu">min</span>(UKB<span class="sc">$</span>TBV, <span class="at">na.rm=</span>T)<span class="sc">-</span><span class="dv">50</span>, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"Mean = "</span>, <span class="fu">round</span>(mean2, <span class="at">digits =</span> <span class="dv">2</span>)), <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">angle =</span> <span class="dv">90</span>)<span class="sc">+</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2.95</span>, <span class="at">y =</span> <span class="fu">min</span>(UKB<span class="sc">$</span>TBV, <span class="at">na.rm=</span>T)<span class="sc">-</span><span class="dv">50</span>, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"Mean = "</span>, <span class="fu">round</span>(mean3, <span class="at">digits =</span> <span class="dv">2</span>)), <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(paste0(out,"phenotypic/UKB_longChange.jpg"), bg = "white",plot = plot, width = 10, height = 10, units = "cm", dpi = 200)</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="UKB_neuro_files/figure-html/rawChange-1.png" class="img-fluid" width="480"></p>
</div>
</div>
</section>
<section id="final-distributions-for-longitudinally-observed-atrophic-change-measures" class="level3">
<h3 class="anchored" data-anchor-id="final-distributions-for-longitudinally-observed-atrophic-change-measures">Final distributions for longitudinally-observed atrophic change measures</h3>
<p>First define <code>plot_hist</code> function.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>plot_hist <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dat =</span> dat, <span class="at">var =</span> <span class="st">"diff_stand"</span>, <span class="at">split_sample_by =</span> <span class="cn">NULL</span>){</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># install packages if they don't already exits</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  packages <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ggplot2"</span>,<span class="st">"stringr"</span>, <span class="st">"tidyr"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="fu">setdiff</span>(packages, <span class="fu">rownames</span>(<span class="fu">installed.packages</span>())))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load packages</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(stringr)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyr)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure input data is data.frame</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">=</span> <span class="fu">as.data.frame</span>(dat)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename for simplicity</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>var <span class="ot">=</span> dat[,var]</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate summary stats</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    df_stats <span class="ot">&lt;-</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        dat <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean =</span> <span class="fu">mean</span>(var, <span class="at">na.rm=</span>T),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">median =</span> <span class="fu">median</span>(var, <span class="at">na.rm=</span>T)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key =</span> Statistic, <span class="at">value =</span> value, mean<span class="sc">:</span>median)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate SD cutoffs</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    insert <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"+2 SDs"</span>, <span class="fu">as.numeric</span>(df_stats[<span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"mean"</span>), <span class="st">"value"</span>]) <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(dat<span class="sc">$</span>var, <span class="at">na.rm=</span>T))</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    df_stats <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_stats, insert)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    insert <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"-2 SDs"</span>, <span class="fu">as.numeric</span>(df_stats[<span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"mean"</span>), <span class="st">"value"</span>]) <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(dat<span class="sc">$</span>var, <span class="at">na.rm=</span>T))</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    df_stats <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_stats, insert)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># format</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    df_stats<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df_stats<span class="sc">$</span>value)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># consider one-sided nature of cut-off</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if difference score, we use the upper 2 SD limit</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if ratio or residual score, we use the lower 2 SD limit</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(var <span class="sc">==</span> <span class="st">"diff"</span> <span class="sc">|</span> var <span class="sc">==</span> <span class="st">"diff_stand"</span>){</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>      df_stats<span class="sc">$</span>value[<span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"-2 SDs"</span>)]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>      <span class="co"># changed my mind, no need for median</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>      df_stats <span class="ot">&lt;-</span> df_stats[<span class="sc">-</span><span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"median"</span>),]</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>      <span class="co"># changed my mind, no need for mean either, it's just distracting</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>      df_stats <span class="ot">&lt;-</span> df_stats[<span class="sc">-</span><span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"mean"</span>),]</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(var <span class="sc">==</span> <span class="st">"ratio"</span> <span class="sc">|</span> var <span class="sc">==</span> <span class="st">"resid"</span> <span class="sc">|</span> var <span class="sc">==</span> <span class="st">"ratio_stand"</span> <span class="sc">|</span> var <span class="sc">==</span> <span class="st">"resid_stand"</span>){</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>      df_stats<span class="sc">$</span>value[<span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"+2 SDs"</span>)]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>      <span class="co"># changed my mind, no need for median</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>      df_stats <span class="ot">&lt;-</span> df_stats[<span class="sc">-</span><span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"median"</span>),]</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># changed my mind, no need for mean either, it's just distracting</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>      df_stats <span class="ot">&lt;-</span> df_stats[<span class="sc">-</span><span class="fu">which</span>(df_stats<span class="sc">$</span>Statistic <span class="sc">==</span> <span class="st">"mean"</span>),]</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PLOT</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># different output when there is a "sample" column</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(split_sample_by)){</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>      plot <span class="ot">=</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> var))<span class="sc">+</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">"#56B4E9"</span>)<span class="sc">+</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_vline</span>(<span class="at">data =</span> df_stats, <span class="fu">aes</span>(<span class="at">xintercept =</span> value, <span class="at">color =</span> Statistic), <span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(var)<span class="sc">+</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ylab</span>(<span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_bw</span>()</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span> <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(split_sample_by)){</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">which</span>(<span class="fu">names</span>(dat) <span class="sc">==</span> split_sample_by)) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">"You have indicated that you wanted to group plotted values by "</span>, split_sample_by,<span class="st">", but the data contains no such column."</span>)); <span class="cf">break</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># incorporate grouping variable</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(dat)[<span class="fu">which</span>(<span class="fu">names</span>(dat) <span class="sc">==</span> split_sample_by)] <span class="ot">=</span> <span class="st">"split_sample_by"</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make sure its a factor</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>split_sample_by <span class="ot">=</span> <span class="fu">as.factor</span>(dat<span class="sc">$</span>split_sample_by)</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#56B4E9"</span>,<span class="st">"#009E73"</span>, <span class="st">"#E69F00"</span>) <span class="co"># "#79AC78" #grDevices::colors()[grep('gr(a|e)y', grDevices::colors(), invert = T)]</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>    colors <span class="ot">=</span> colors[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(dat<span class="sc">$</span>split_sample_by))]</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>      plot <span class="ot">=</span> <span class="fu">ggplot</span>(dat)<span class="sc">+</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> var, <span class="at">fill =</span> split_sample_by), <span class="at">bins =</span> <span class="dv">100</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors, <span class="at">name =</span> split_sample_by)<span class="sc">+</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_vline</span>(<span class="at">data =</span> df_stats, <span class="fu">aes</span>(<span class="at">xintercept =</span> value, <span class="at">color =</span> Statistic), <span class="at">size =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>          <span class="fu">xlab</span>(var)<span class="sc">+</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ylab</span>(<span class="st">"Count"</span>)<span class="sc">+</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_bw</span>()</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># make second x-axis if we're working with standardised variables</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">grep</span>(<span class="st">"_stand"</span>, var)) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>      <span class="co"># calculate mean from original variable</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>      varOr <span class="ot">=</span> <span class="fu">str_remove</span>(var, <span class="st">"_stand"</span>)</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>      mean <span class="ot">=</span> <span class="fu">mean</span>(dat[,varOr], <span class="at">na.rm=</span>T)</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>      sd <span class="ot">=</span> <span class="fu">sd</span>(dat[,varOr], <span class="at">na.rm=</span>T)</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>      <span class="co"># add secondary x axis</span></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>      plot <span class="ot">=</span> plot<span class="sc">+</span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>         <span class="fu">scale_x_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">name =</span> <span class="st">"Raw values"</span>, <span class="at">trans=</span><span class="sc">~</span>.<span class="sc">*</span>sd<span class="sc">+</span>mean))</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>  plot <span class="ot">=</span> plot<span class="sc">+</span><span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_blank</span>())</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot)</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that I noticed the extreme outliers only later on in the analysis process, which is why this first step cleaning the measures is included (nature of an organic document I guess, sorry!).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>UKB <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(out, <span class="st">"/UKB_neuroNoLongProcess.txt"</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only one wave (long data is duplicated here)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>UKB2 <span class="ot">=</span> UKB[<span class="fu">which</span>(UKB<span class="sc">$</span>wave <span class="sc">==</span> <span class="dv">2</span>), ]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>UKB2 <span class="ot">&lt;-</span> UKB2[<span class="fu">which</span>(UKB2<span class="sc">$</span>TBVdiff_2to3_stand <span class="sc">&lt;</span> <span class="dv">10</span>),]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>UKB2 <span class="ot">&lt;-</span> UKB2[<span class="fu">which</span>(UKB2<span class="sc">$</span>TBVdiff_2to3_stand <span class="sc">&gt;</span> (<span class="sc">-</span><span class="dv">10</span>)),]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>UKB2 <span class="ot">&lt;-</span> UKB2[<span class="fu">which</span>(UKB2<span class="sc">$</span>TBVratio_3to2_stand <span class="sc">&lt;</span> <span class="dv">10</span>),]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>UKB2 <span class="ot">&lt;-</span> UKB2[<span class="fu">which</span>(UKB2<span class="sc">$</span>TBVratio_3to2_stand <span class="sc">&gt;</span> (<span class="sc">-</span><span class="dv">10</span>)),]</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>UKB2 <span class="ot">&lt;-</span> UKB2[<span class="fu">which</span>(UKB2<span class="sc">$</span>TBVresid_2to3_stand <span class="sc">&lt;</span> <span class="dv">10</span>),]</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>UKB2 <span class="ot">&lt;-</span> UKB2[<span class="fu">which</span>(UKB2<span class="sc">$</span>TBVresid_2to3_stand <span class="sc">&gt;</span> (<span class="sc">-</span><span class="dv">10</span>)),]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># difference score</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">plot_hist</span>(<span class="at">dat =</span> UKB2, <span class="at">var =</span> <span class="st">"TBVdiff_2to3_stand"</span>)<span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"TBV1 - TBV2</span><span class="sc">\n</span><span class="st">(Difference score)"</span>)<span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">"#D81B60"</span>)<span class="sc">+</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_pretty</span>()</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">$</span>layers[[<span class="dv">2</span>]] <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ratio score</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">plot_hist</span>(<span class="at">dat =</span> UKB2, <span class="at">var =</span> <span class="st">"TBVratio_3to2_stand"</span>)<span class="sc">+</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"TBV2 divided by TBV1</span><span class="sc">\n</span><span class="st">(Ratio score)"</span>)<span class="sc">+</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">"#FFC107"</span>)<span class="sc">+</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_pretty</span>()</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>p2<span class="sc">$</span>layers[[<span class="dv">2</span>]] <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># resid score</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">plot_hist</span>(<span class="at">dat =</span> UKB2, <span class="at">var =</span> <span class="st">"TBVresid_2to3_stand"</span>)<span class="sc">+</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"TBV2 ~ TBV1</span><span class="sc">\n</span><span class="st">(Residual score)"</span>)<span class="sc">+</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">"#004D40"</span>)<span class="sc">+</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_pretty</span>()</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>p3<span class="sc">$</span>layers[[<span class="dv">2</span>]] <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">=</span> <span class="fu">plot_grid</span>(p1, p2, p3, <span class="at">nrow=</span><span class="dv">1</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>), <span class="at">label_size =</span> <span class="dv">6</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co">#ggsave(paste0(out, "phenotypic/UKBlong_distribution.png"), plot = plot, width = 11, height = 5, units = "cm", dpi = 600)</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="UKB_neuro_files/figure-html/longHist-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>