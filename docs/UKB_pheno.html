<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Anna Elisabeth Furtjes">
<meta name="dcterms.date" content="2025-06-06">

<title>Brain Atrophy Genetics - UKB: Phenotypic data preparation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Brain Atrophy Genetics</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Overview</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link active" data-scroll-target="#load-packages">Load packages</a></li>
  <li><a href="#define-function" id="toc-define-function" class="nav-link" data-scroll-target="#define-function">Define function</a></li>
  <li><a href="#cognitive-test-factor-scores" id="toc-cognitive-test-factor-scores" class="nav-link" data-scroll-target="#cognitive-test-factor-scores">Cognitive test (factor scores)</a></li>
  <li><a href="#dementia-status" id="toc-dementia-status" class="nav-link" data-scroll-target="#dementia-status">Dementia status</a></li>
  <li><a href="#apoe-status" id="toc-apoe-status" class="nav-link" data-scroll-target="#apoe-status">APOE status</a></li>
  <li><a href="#type-2-diabetes" id="toc-type-2-diabetes" class="nav-link" data-scroll-target="#type-2-diabetes">Type 2 diabetes</a></li>
  <li><a href="#hypertension" id="toc-hypertension" class="nav-link" data-scroll-target="#hypertension">Hypertension</a></li>
  <li><a href="#smoking-packyears" id="toc-smoking-packyears" class="nav-link" data-scroll-target="#smoking-packyears">Smoking (packyears)</a></li>
  <li><a href="#body-mass-index" id="toc-body-mass-index" class="nav-link" data-scroll-target="#body-mass-index">Body mass index</a></li>
  <li><a href="#stroke" id="toc-stroke" class="nav-link" data-scroll-target="#stroke">Stroke</a></li>
  <li><a href="#fried-frailty-definition" id="toc-fried-frailty-definition" class="nav-link" data-scroll-target="#fried-frailty-definition">Fried frailty definition</a></li>
  <li><a href="#brain-age" id="toc-brain-age" class="nav-link" data-scroll-target="#brain-age">Brain Age</a>
  <ul class="collapse">
  <li><a href="#format-individual-level-data" id="toc-format-individual-level-data" class="nav-link" data-scroll-target="#format-individual-level-data">Format individual-level data</a></li>
  </ul></li>
  <li><a href="#merge-all-ukb-phenotypes-into-one-file" id="toc-merge-all-ukb-phenotypes-into-one-file" class="nav-link" data-scroll-target="#merge-all-ukb-phenotypes-into-one-file">Merge all UKB phenotypes into one file</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">UKB: Phenotypic data preparation</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Anna Elisabeth Furtjes </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 6, 2025</p>
    </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Doi</div>
    <div class="quarto-title-meta-contents">
      <p class="doi">
        <a href="https://doi.org/10.1101/2024.11.06.622274">10.1101/2024.11.06.622274</a>
      </p>
    </div>
  </div>
  </div>
  

</header>

<hr>
<p>Data prepared here was used as input into analyses presented <a href="pheno_assocs.html">here</a>. The file containing all phenotypic variables was named <code>UKB_allPheno.txt</code>.</p>
<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load packages</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="define-function" class="level2">
<h2 class="anchored" data-anchor-id="define-function">Define function</h2>
<p>The function <code>getFieldLoc</code> identifies the directory with the most recent UKB download. We have multiple files on the server from different downloads, and I want to be sure I use the most recent one (i.e., the one saved in a directory with the highest number).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># script that searches in our available data if we have a certain data field</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>getFieldLoc <span class="ot">=</span> <span class="cf">function</span>(<span class="at">path =</span> path, <span class="at">fileName =</span> fileName, <span class="at">fieldID =</span> fieldID){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read all the field.ukb files</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  files_to_read <span class="ot">=</span> <span class="fu">list.files</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> path,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> fileName,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">recursive =</span> T,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">full.names =</span> T</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read all files</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">=</span> <span class="fu">lapply</span>(files_to_read, fread)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat) <span class="ot">=</span> files_to_read</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># search for field ID of interest </span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  candidates <span class="ot">=</span> <span class="fu">names</span>(dat)[<span class="fu">grep</span>(fieldID, dat)]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># figure out which one is from the most recent file (i.e., highest number)</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  candidates <span class="ot">=</span> <span class="fu">str_remove</span>(candidates, <span class="fu">paste0</span>(path, <span class="st">"/"</span>))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  candidates <span class="ot">=</span> <span class="fu">str_remove</span>(candidates, <span class="fu">paste0</span>(<span class="st">"/"</span>, fileName))</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  candidates <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">as.numeric</span>(<span class="fu">sapply</span>(<span class="fu">str_extract_all</span>(candidates, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>), tail , <span class="dv">1</span>)))</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  most_recent <span class="ot">=</span> <span class="fu">max</span>(candidates, <span class="at">na.rm =</span>T)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">paste0</span>(path, most_recent))</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cognitive-test-factor-scores" class="level2">
<h2 class="anchored" data-anchor-id="cognitive-test-factor-scores">Cognitive test (factor scores)</h2>
<p>Input data used here was kindly provided by Joanna Moodie who had modeled the g-factor for one of her previous projects. The factor was modeled on the whole UKB sample, and then restricted to the participants with available neuroimaging data. This was deemed appropriate because the variables remained normally distributed in the restricted sample. Modelling the factor in the full sample will hopefully mean that the factor was based on a more representative sample than relying on participants who returned for their second neuroimaigng visit (healthy selection bias).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">### This script was adapted from Joanna Moodies script</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lavaan)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the data</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>UKBcog <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/UKB_g/UKB_cogtests.csv"</span>, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># name ID column</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(UKBcog)[<span class="fu">which</span>(<span class="fu">names</span>(UKBcog) <span class="sc">==</span> <span class="st">"ID"</span>)] <span class="ot">=</span> <span class="st">"f.eid"</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># re-formatting data</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>UKBcog<span class="sc">$</span>cog_trailB_log[<span class="fu">which</span>(UKBcog<span class="sc">$</span>cog_trailB_log <span class="sc">==</span> <span class="dv">0</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>UKBcog<span class="sc">$</span>cog_prosmem[<span class="fu">which</span>(UKBcog<span class="sc">$</span>cog_prosmem <span class="sc">==</span> <span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>UKBcog<span class="sc">$</span>cog_pairedAss <span class="ot">&lt;-</span> <span class="fu">exp</span>(UKBcog<span class="sc">$</span>cog_pairedAss_log)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#UKBcog &lt;- merge(UKBcog, ' ', by = "ID") # select the participants you want in the sample</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># keep varibales of interest</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>UKBcog <span class="ot">=</span> UKBcog[,<span class="fu">c</span>(<span class="st">"f.eid"</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"cog_RT_log"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"cog_numeric_memory"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"cog_fluid_intelligence"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"cog_trailB_log"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"cog_matrix_pattern_correct"</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"cog_tower"</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"cog_digsym"</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"cog_pairedAss"</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"cog_prosmem"</span>,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"cog_pairsmatch_incorrect_log"</span>)]</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># define general factor model</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>cogmodel <span class="ot">&lt;-</span> <span class="st">'g =~  cog_RT_log +</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="st">                    cog_numeric_memory + </span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="st">                    cog_fluid_intelligence + </span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="st">                    cog_trailB_log + </span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="st">                    cog_matrix_pattern_correct + </span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="st">                    cog_tower + </span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="st">                    cog_digsym + </span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="st">                    cog_pairsmatch_incorrect_log +</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="st">                    cog_prosmem +</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="st">                    cog_pairedAss</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="st">                    '</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co"># fit general factor model</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">cfa</span>(cogmodel, <span class="at">data =</span> UKBcog, <span class="at">missing=</span><span class="st">"ML"</span>)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit, <span class="at">fit.measures=</span><span class="cn">TRUE</span>, <span class="at">standardized=</span>T)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co"># save fit for later</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(fit, <span class="at">file =</span> <span class="fu">paste0</span>(out,<span class="st">"/fit.RData"</span>))</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co"># predict individual-level factor scores </span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>gPheno <span class="ot">&lt;-</span> <span class="fu">lavPredict</span>(fit, UKBcog)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>gPheno <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(UKBcog<span class="sc">$</span>f.eid, gPheno))</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co"># re-name columns</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gPheno) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"f.eid"</span>,<span class="st">"g"</span>)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(gPheno$g)</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="co"># standardise</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>gPheno<span class="sc">$</span>gStand <span class="ot">=</span> <span class="fu">scale</span>(gPheno<span class="sc">$</span>g)</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="co"># save in separate file </span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(gPheno[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"gStand"</span>)], <span class="at">file =</span> <span class="fu">paste0</span>(out, <span class="st">"/UKB_gFactor.txt"</span>), <span class="at">quote =</span> F, <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="dementia-status" class="level2">
<h2 class="anchored" data-anchor-id="dementia-status">Dementia status</h2>
<p>Note that according to this definition only 5 participants a diagnosis, and the remaining ones are proxy cases.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## find items and where they are stored on the server</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">## dementia is defined based on multiple sources of information we have in the UKV</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. ICD-10 diagnoses: field ID 41270</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. Self-reported illnesses (dementia, alzheimers, cognitive impairment): field ID 20002</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. Source of all cause dementia report: field ID 42019</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 4. Contributing causes of death: field ID 40001 &amp; 40002</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 5. Date F00 first reported: field ID 130836</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. ICD-10 diagnoses: field ID 41270</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># determine file paths</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>path1 <span class="ot">=</span> <span class="fu">getFieldLoc</span>(<span class="at">path =</span> path, </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">fileName =</span> <span class="st">"fields.ukb"</span>, </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">fieldID =</span> <span class="dv">41270</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path1,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path1, <span class="st">"/"</span>, fileID))</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">#names(file) = str_replace(names(file), pattern = "-", replacement = "_")</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>dementCols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.41270"</span>, <span class="fu">names</span>(file))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>dement <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..dementCols)])</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(dement)[<span class="fu">grep</span>(<span class="st">"f.41270"</span>, <span class="fu">names</span>(dement))]){</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  dement[<span class="fu">which</span>(dement[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(dement[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(dement) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 55361</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD codes of interest to find in field ID 41270</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>ICDcode<span class="ot">=</span><span class="fu">c</span>(<span class="st">"F00"</span>,<span class="st">"F000"</span>,<span class="st">"F001"</span>,<span class="st">"F002"</span>,<span class="st">"F009"</span>,<span class="st">"G30"</span>,<span class="st">"G300"</span>,<span class="st">"G301"</span>,<span class="st">"G308"</span>,<span class="st">"G309"</span>,<span class="st">"F01"</span>,<span class="st">"F010"</span>,<span class="st">"F011"</span>,<span class="st">"F012"</span>,<span class="st">"F013"</span>,<span class="st">"F018"</span>,<span class="st">"F019"</span>,<span class="st">"I673"</span>,<span class="st">"F03"</span>,<span class="st">"G311"</span>,<span class="st">"G318"</span>)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co"># match ICDcodes with entries in all f.41270 variables filtered in 'dement'</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(dement[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(dement) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, ICDcode)))</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consisder a case</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>dementICD41270 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(dement<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>dementICD41270[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="co"># save this variable to a seperate file</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(dement[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"dementICD41270"</span>)], <span class="at">file =</span> <span class="fu">paste0</span>(out, <span class="st">"/UKB_dement_ICD41270.txt"</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">na =</span> <span class="cn">NA</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. Self-reported illnesses (dementia, alzheimers, cognitive impairment, code = 1263): field ID 20002</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="do">#############################################</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path2,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path2, <span class="st">"/"</span>, fileID))</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="co">#names(file) = str_replace(names(file), pattern = "-", replacement = "_")</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>dementCols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.20002"</span>, <span class="fu">names</span>(file))</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>dement <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..dementCols)])</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (except their participant ID)</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(dement[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(dement) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="co"># 113066</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="co"># determine code of interest to find in this field ID</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>code <span class="ot">=</span> <span class="st">"1263"</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="co"># match ICDcodes with entries in all f.41270 variables filtered in 'dement'</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(dement[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(dement) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match,code)))</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consisder a case</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>dement20002 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(dement<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>dement20002[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>dement20002 <span class="ot">=</span> dement<span class="sc">$</span>dement20002</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. Source of all cause dementia report: field ID 42019</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="do">################################################</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>dementCols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.42019"</span>, <span class="fu">names</span>(file))</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>dement <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..dementCols)])</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a><span class="co"># only record whether participants have an entry, which is indicative of dementia</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="co"># however the absence of a code does not mean they don't have dementia</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>dement42019 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(dement<span class="sc">$</span>f<span class="fl">.42019</span>_0<span class="fl">.0</span>), <span class="dv">1</span>, <span class="cn">NA</span>))</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>dement42019 <span class="ot">=</span> dement<span class="sc">$</span>dement42019</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a><span class="do">###################################################</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a><span class="do">## 4. Contributing causes of death: field ID 40001 &amp; 40002</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a><span class="do">###################################################</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>dementCols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.40001"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.40002"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>dement <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..dementCols)])</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(dement)[<span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.40001"</span>, <span class="fu">names</span>(dement)), <span class="fu">grep</span>(<span class="st">"f.40002"</span>, <span class="fu">names</span>(dement)))]){</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>  dement[<span class="fu">which</span>(dement[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD codes of interest to find in field ID </span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>ICDcode<span class="ot">=</span><span class="fu">c</span>(<span class="st">"F00"</span>,<span class="st">"F000"</span>,<span class="st">"F001"</span>,<span class="st">"F002"</span>,<span class="st">"F009"</span>,<span class="st">"G30"</span>,<span class="st">"G300"</span>,<span class="st">"G301"</span>,<span class="st">"G308"</span>,<span class="st">"G309"</span>,<span class="st">"F01"</span>,<span class="st">"F010"</span>,<span class="st">"F011"</span>,<span class="st">"F012"</span>,<span class="st">"F013"</span>,<span class="st">"F018"</span>,<span class="st">"F019"</span>,<span class="st">"I673"</span>,<span class="st">"F03"</span>,<span class="st">"G311"</span>,<span class="st">"G318"</span>)</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a><span class="co"># match ICDcodes with entries in all f.41270 variables filtered in 'dement'</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(dement[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(dement) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, ICDcode)))</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a><span class="co"># but if there is no entry, it probably more often means this person has not died yet, rather than that they had no dementia</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>dementDeath<span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(dement<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>))</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>dementDeath <span class="ot">=</span> dement<span class="sc">$</span>dementDeath</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="do">## 5. Illnesses of father and mother (Alzheimer's disease/dementia; code = 10): field ID 20107 &amp; 20110</span></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a>dementCols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.20107"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.20110"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>dement <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..dementCols)])</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a><span class="co"># remove all minus (-) values</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>dement[dement <span class="sc">&lt;=</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a><span class="co"># determine codes of interest to find in field ID </span></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>code<span class="ot">=</span><span class="fu">c</span>(<span class="dv">10</span>)</span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a><span class="co"># match ICDcodes with entries in all f.41270 variables filtered in 'dement'</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(dement[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(dement) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, code)))</span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a report on parents, so absence of entry does not mean they don't have dementia</span></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>dementParents <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(dement<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="cn">NA</span>))</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>dementParents <span class="ot">=</span> dement<span class="sc">$</span>dementParents</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a><span class="do">################################################</span></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a><span class="do">## 5. Date F00 first reported: field ID 130836</span></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a><span class="do">###############################################</span></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a>dementCols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.130836"</span>, <span class="fu">names</span>(file))</span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a>dement <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..dementCols)])</span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a><span class="co"># store IDs for coded dates that suggest mistakes - however, doesnt contain any of the coded fields</span></span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a><span class="co"># which(dement$f.130836_0.0 == "1901-01-01")</span></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a><span class="co"># record who has date </span></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>dement130836 <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>dement130836[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(dement<span class="sc">$</span>f<span class="fl">.130836</span>_0<span class="fl">.0</span>))] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a><span class="co"># store in file</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>dement130836 <span class="ot">=</span> <span class="fu">as.factor</span>(dement<span class="sc">$</span>dement130836)</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a><span class="do">################################################</span></span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a><span class="do">## Combine all data sources to one phenotype</span></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a><span class="do">################################################</span></span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a><span class="co"># keep columns of interest</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"dement20002"</span>, <span class="st">"dement42019"</span>, <span class="st">"dementDeath"</span>,<span class="st">"dementParents"</span>,<span class="st">"dement130836"</span>)]</span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a><span class="co"># read in info from item 41270 (that was saved on a txt file - see (1.)) </span></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>var41270 <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(out, <span class="st">"/UKB_dement_ICD41270.txt"</span>), <span class="at">header =</span> T)</span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>var41270<span class="sc">$</span>dementICD41270 <span class="ot">=</span> <span class="fu">as.factor</span>(var41270<span class="sc">$</span>dementICD41270)</span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a><span class="co"># merge with info above</span></span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">merge</span>(var41270, file, <span class="at">by =</span> <span class="st">"f.eid"</span>))</span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those with all missing</span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(file[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a><span class="co"># identify cases</span></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>dement <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a><span class="co"># identify cases</span></span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>dement[<span class="fu">which</span>(file<span class="sc">$</span>dement20002 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>dement42019 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>dementDeath <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>dementParents <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>dementICD41270 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>dement130836 <span class="sc">==</span> <span class="dv">1</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a><span class="co"># delete allMissing from controls</span></span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>dement[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a><span class="co"># make factor</span></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>dement <span class="ot">=</span> <span class="fu">as.factor</span>(file<span class="sc">$</span>dement)</span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a><span class="co">#dementICD41270 dement20002   dement42019   dementDeath   dementParents  dement      </span></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a><span class="co">#0   :442840    0   :389146   1   :  7896   1   :   860   1   : 66764   1   : 73835  </span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a><span class="co">#1   :  4156    1   :   156   NA's:494461   NA's:501497   NA's:435593   0   : 409281</span></span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a><span class="co">#NA's: 55361    NA's:113055                                             NA's: 19241</span></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a><span class="co"># save final variable to a seperate file</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"dement"</span>)], <span class="at">file =</span> <span class="fu">paste0</span>(out, <span class="st">"/UKB_DementiaStatus.txt"</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">na =</span> <span class="cn">NA</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="apoe-status" class="level2">
<h2 class="anchored" data-anchor-id="apoe-status">APOE status</h2>
<p>First extract the two SNPs of interest using PLINK2.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter for the two APOE SNPs</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">plink2</span> <span class="at">--bfile</span> <span class="va">$loc</span>/UKB500K_autosomes_X_XY_MAF_01_CLEAN_07052018_GD <span class="at">--snps</span> rs7412,rs429358 <span class="at">--make-bed</span> <span class="at">--freq</span> <span class="at">--export</span> A <span class="at">--out</span> <span class="va">$temp</span>/UKB_APOE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, model APOE status according to the approach used <a href="https://www.thelancet.com/journals/ebiom/article/PIIS2352-3964(20)30330-3/fulltext#seccesectitle0014">here</a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine whether someone has the e4 allele</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(temp, <span class="st">"/UKB_APOE.raw"</span>), <span class="at">header =</span> T)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="do">## simplify data</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># remove -IDs and remove redundant columns</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> dat[<span class="sc">-</span><span class="fu">which</span>(dat<span class="sc">$</span>FID <span class="sc">&lt;</span> <span class="dv">0</span>),<span class="fu">c</span>(<span class="st">"FID"</span>, <span class="st">"rs429358_T"</span>, <span class="st">"rs7412_C"</span>)]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># code variables to match look-up table</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>rs429358 <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>rs429358[<span class="fu">which</span>(dat<span class="sc">$</span>rs429358_T <span class="sc">==</span> <span class="dv">2</span>)] <span class="ot">=</span> <span class="st">"TT"</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>rs429358[<span class="fu">which</span>(dat<span class="sc">$</span>rs429358_T <span class="sc">==</span> <span class="dv">1</span>)] <span class="ot">=</span> <span class="st">"CT"</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>rs429358[<span class="fu">which</span>(dat<span class="sc">$</span>rs429358_T <span class="sc">==</span> <span class="dv">0</span>)] <span class="ot">=</span> <span class="st">"CC"</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>rs7412 <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>rs7412[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412_C <span class="sc">==</span> <span class="dv">2</span>)] <span class="ot">=</span> <span class="st">"CC"</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>rs7412[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412_C <span class="sc">==</span> <span class="dv">1</span>)] <span class="ot">=</span> <span class="st">"CT"</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>rs7412[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412_C <span class="sc">==</span> <span class="dv">0</span>)] <span class="ot">=</span> <span class="st">"TT"</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># code variables according to combination of those genotypes</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEgeno <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEgeno[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412 <span class="sc">==</span> <span class="st">"CC"</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>rs429358 <span class="sc">==</span> <span class="st">"CC"</span>)] <span class="ot">=</span> <span class="st">"e4/e4"</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEgeno[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412 <span class="sc">==</span> <span class="st">"CC"</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>rs429358 <span class="sc">==</span> <span class="st">"CT"</span>)] <span class="ot">=</span> <span class="st">"e3/e4"</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEgeno[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412 <span class="sc">==</span> <span class="st">"CT"</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>rs429358 <span class="sc">==</span> <span class="st">"CT"</span>)] <span class="ot">=</span> <span class="st">"e2/e4"</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEgeno[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412 <span class="sc">==</span> <span class="st">"CC"</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>rs429358 <span class="sc">==</span> <span class="st">"TT"</span>)] <span class="ot">=</span> <span class="st">"e3/e3"</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEgeno[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412 <span class="sc">==</span> <span class="st">"CT"</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>rs429358 <span class="sc">==</span> <span class="st">"TT"</span>)] <span class="ot">=</span> <span class="st">"e2/e3"</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEgeno[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412 <span class="sc">==</span> <span class="st">"TT"</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>rs429358 <span class="sc">==</span> <span class="st">"TT"</span>)] <span class="ot">=</span> <span class="st">"e2/e2"</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEgeno[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412 <span class="sc">==</span> <span class="st">"CT"</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>rs429358 <span class="sc">==</span> <span class="st">"CC"</span>)] <span class="ot">=</span> <span class="st">"e1/e4"</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEgeno[<span class="fu">which</span>(dat<span class="sc">$</span>rs7412 <span class="sc">==</span> <span class="st">"TT"</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>rs429358 <span class="sc">==</span> <span class="st">"CT"</span>)] <span class="ot">=</span> <span class="st">"e1/e2"</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># infer APOE status</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEstatus <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEstatus[<span class="fu">which</span>(dat<span class="sc">$</span>APOEgeno <span class="sc">==</span> <span class="st">"e4/e4"</span> <span class="sc">|</span> dat<span class="sc">$</span>APOEgeno <span class="sc">==</span> <span class="st">"e3/e4"</span> <span class="sc">|</span> dat<span class="sc">$</span>APOEgeno <span class="sc">==</span> <span class="st">"e2/e4"</span> <span class="sc">|</span> dat<span class="sc">$</span>APOEgeno <span class="sc">==</span> <span class="st">"e1/e4"</span>)] <span class="ot">=</span> <span class="st">"e4Allele"</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>APOEstatus[<span class="fu">which</span>(dat<span class="sc">$</span>APOEgeno <span class="sc">==</span> <span class="st">"e3/e3"</span> <span class="sc">|</span> dat<span class="sc">$</span>APOEgeno <span class="sc">==</span> <span class="st">"e2/e3"</span> <span class="sc">|</span> dat<span class="sc">$</span>APOEgeno <span class="sc">==</span> <span class="st">"e2/e2"</span> <span class="sc">|</span> dat<span class="sc">$</span>APOEgeno <span class="sc">==</span> <span class="st">"e1/e2"</span>)] <span class="ot">=</span> <span class="st">"NOe4Allele"</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>APOEstatus, dat<span class="sc">$</span>APOEgeno)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co">#              e1/e2  e1/e4  e2/e2  e2/e3  e2/e4  e3/e3  e3/e4  e4/e4</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co">#  e4Allele        0     13      0      0   8818      0  82089   8266</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="co">#  NOe4Allele      2      0   1984  42269      0 199277      0      0</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only 2 columns</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> dat[,<span class="fu">c</span>(<span class="st">"FID"</span>, <span class="st">"APOEgeno"</span>, <span class="st">"APOEstatus"</span>)]</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(dat, <span class="fu">paste0</span>(save, <span class="st">"/UKB_APOE_Nov2023.txt"</span>), <span class="at">quote =</span> F, <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="type-2-diabetes" class="level2">
<h2 class="anchored" data-anchor-id="type-2-diabetes">Type 2 diabetes</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## dementia is defined based on multiple sources of information we have in the UKB</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. Self-reported illness (field ID 20002) &amp; self-reported diagnosis by doctor (2443)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. ICD9 diagnoses (field ID 41203 &amp; 41205)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. ICD10 diagnoses (field ID 41202 &amp; 41204)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4. Cause of death (field ID 40001)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">#########################################</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. Self-reported illness (field IDs 20002, 2443, 2986, 2976, 21003) </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">#########################################</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="do">#### field ID 20002</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="do">####################</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.20002"</span>, <span class="fu">names</span>(file))</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>t2d <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(t2d[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(t2d) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 113066</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co"># determine codes of interest to find in field ID 41270</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>t2d_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1233"</span>,<span class="st">"1220"</span>)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co"># match ICDcodes with entries in all f.20002 variables filtered in 't2d'</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(t2d[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(t2d) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, t2d_codes)))</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>t2d20002 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(t2d<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>t2d20002[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>t2d20002 <span class="ot">=</span> t2d<span class="sc">$</span>t2d20002</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="do">#### field 2443</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="do">#### diabetes self-report interview touchscreen </span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="do">#################################</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.2443"</span>, <span class="fu">names</span>(file))</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>t2d <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="co"># remove all minus (-) values as they stand for "do not know" or "Prefer not to answer"</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>t2d[t2d <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(t2d[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(t2d) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="co"># determine codes of interest to find in field </span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>diab_code <span class="ot">&lt;-</span> <span class="st">"1"</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="co"># match codes with entries in all variables filtered in 't2d'</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(t2d[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(t2d) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, diab_code)))</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>t2d2443 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(t2d<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>t2d2443[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>t2d2443 <span class="ot">=</span> t2d<span class="sc">$</span>t2d2443</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="do">## 4. Cause of death (field ID 40001)</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.40001"</span>, <span class="fu">names</span>(file))</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>t2d <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(t2d)[<span class="fu">grep</span>(<span class="st">"f.40001"</span>, <span class="fu">names</span>(t2d))]){</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>  t2d[<span class="fu">which</span>(t2d[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(t2d[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(t2d) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD10 codes of interest to find in field </span></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>diab_code <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"E110"</span>,<span class="st">"E111"</span>,<span class="st">"E112"</span>,<span class="st">"E113"</span>,<span class="st">"E114"</span>,<span class="st">"E115"</span>,<span class="st">"E116"</span>,<span class="st">"E117"</span>,<span class="st">"E118"</span>,<span class="st">"E119"</span>)</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a><span class="co"># match codes with entries in all variables filtered in 't2d'</span></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(t2d[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(t2d) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, diab_code)))</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>t2dDeath <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(t2d<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>t2dDeath[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>t2dDeath <span class="ot">=</span> t2d<span class="sc">$</span>t2dDeath</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a><span class="co"># intermediate save data </span></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>save <span class="ot">=</span> file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"t2d20002"</span>, <span class="st">"t2d2443"</span>, <span class="st">"t2dDeath"</span>)]</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. ICD10 diagnoses (field ID 41202 &amp; 41204)</span></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a><span class="do">### read in new data; basket 675090 has newer data for these variables </span></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41202"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.41204"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>t2d <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(t2d)[<span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41202"</span>, <span class="fu">names</span>(t2d)), <span class="fu">grep</span>(<span class="st">"f.41204"</span>, <span class="fu">names</span>(t2d)))]){</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>  t2d[<span class="fu">which</span>(t2d[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(t2d[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(t2d) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD10 codes of interest to find in field </span></span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>diab_code <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"E110"</span>,<span class="st">"E111"</span>,<span class="st">"E112"</span>,<span class="st">"E113"</span>,<span class="st">"E114"</span>,<span class="st">"E115"</span>,<span class="st">"E116"</span>,<span class="st">"E117"</span>,<span class="st">"E118"</span>,<span class="st">"E119"</span>)</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a><span class="co"># match codes with entries in all variables filtered in 't2d'</span></span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(t2d[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(t2d) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, diab_code)))</span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>t2dICD41202_4 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(t2d<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>t2dICD41202_4[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>t2dICD41202_4 <span class="ot">=</span> t2d<span class="sc">$</span>t2dICD41202_4</span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. ICD9 diagnoses (field ID 41203 &amp; 41205)</span></span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41203"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.41205"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>t2d <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(t2d)[<span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41203"</span>, <span class="fu">names</span>(t2d)), <span class="fu">grep</span>(<span class="st">"f.41205"</span>, <span class="fu">names</span>(t2d)))]){</span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a>  t2d[<span class="fu">which</span>(t2d[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(t2d[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(t2d) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD10 codes of interest to find in field </span></span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>diab_code <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"25000"</span>,<span class="st">"25010"</span>,<span class="st">"25020"</span>,<span class="st">"25090"</span>)</span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a><span class="co"># match codes with entries in all variables filtered in 't2d'</span></span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(t2d[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(t2d) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, diab_code)))</span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>t2dICD41203_5 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(t2d<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a>t2d<span class="sc">$</span>t2dICD41203_5[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb7-188"><a href="#cb7-188" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>t2dICD41203_5 <span class="ot">=</span> t2d<span class="sc">$</span>t2dICD41203_5</span>
<span id="cb7-189"><a href="#cb7-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a><span class="do">## Combine all t2d</span></span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a><span class="co"># merge with saved columns above</span></span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">merge</span>(file, save, <span class="at">by =</span> <span class="st">"f.eid"</span>)</span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a><span class="co"># keep columns of interest only</span></span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"t2d20002"</span>, <span class="st">"t2d2443"</span>, <span class="st">"t2dICD41202_4"</span>, <span class="st">"t2dICD41203_5"</span>, <span class="st">"t2dDeath"</span>)])</span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those with all missing</span></span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(file[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a><span class="co"># identify cases</span></span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>t2d <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a><span class="co"># identify cases</span></span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>t2d[<span class="fu">which</span>(file<span class="sc">$</span>t2d20002 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>t2d2443 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>t2dICD41202_4 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>t2dICD41203_5 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>t2dDeath <span class="sc">==</span> <span class="dv">1</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a><span class="co"># delete allMissing from controls</span></span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>t2d[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a><span class="co"># make factor</span></span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>t2d <span class="ot">=</span> <span class="fu">as.factor</span>(file<span class="sc">$</span>t2d)</span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a><span class="co">#     0      1 </span></span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a><span class="co"># 451786  50436</span></span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a><span class="co"># save final variable to a seperate file</span></span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"t2d"</span>)], <span class="at">file =</span> <span class="fu">paste0</span>(out, <span class="st">"/UKB_t2dStatus.txt"</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">na =</span> <span class="cn">NA</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="hypertension" class="level2">
<h2 class="anchored" data-anchor-id="hypertension">Hypertension</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hypertension is defined based on multiple field IDs</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. Self-reported illness (field ID 20002) &amp; self-reported diagnosis by doctor (2443)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. ICD9 diagnoses (field ID 41203 &amp; 41205)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. ICD10 diagnoses (field ID 41202 &amp; 41204)</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4. Cause of death (field ID 40001)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">#########################################</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. Self-reported illness (field IDs 20002, 2443, 2986, 2976, 21003) </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">#########################################</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="do">#### field ID 20002</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="do">####################</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.20002"</span>, <span class="fu">names</span>(file))</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>hyp <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(hyp[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(hyp) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 113066</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># determine codes of interest to find in field ID 41270</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>hyp_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1065"</span>,<span class="st">"1072"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co"># match ICDcodes with entries in all f.20002 variables filtered in 't2d'</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(hyp[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(hyp) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, hyp_codes)))</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hyp20002 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(hyp<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hyp20002[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>hyp20002 <span class="ot">=</span> hyp<span class="sc">$</span>hyp20002</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="do">#### field 131287</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="do">#### Source of report of I10 </span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="do">#################################</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.131287"</span>, <span class="fu">names</span>(file))</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>hyp <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">is.na</span>(hyp[,<span class="fu">which</span>(<span class="fu">names</span>(hyp) <span class="sc">!=</span> <span class="st">"f.eid"</span>)])) </span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="co"># determine participants with non missing </span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>allPresent <span class="ot">=</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(hyp[,<span class="fu">which</span>(<span class="fu">names</span>(hyp) <span class="sc">!=</span> <span class="st">"f.eid"</span>)]))</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="co"># consider non-missing a case</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hyp131287 <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hyp131287[allPresent] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>hyp131287 <span class="ot">=</span> hyp<span class="sc">$</span>hyp131287</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="do">## 4. Cause of death (field ID 40001)</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.40001"</span>, <span class="fu">names</span>(file))</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>hyp <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(hyp)[<span class="fu">grep</span>(<span class="st">"f.40001"</span>, <span class="fu">names</span>(hyp))]){</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>  hyp[<span class="fu">which</span>(hyp[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(hyp[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(hyp) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD10 codes of interest to find in field </span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>hyp_code <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"I10"</span>)</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="co"># match codes with entries in all variables filtered in 'hyp'</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(hyp[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(hyp) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, hyp_code)))</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hypDeath <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(hyp<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hypDeath[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>hypDeath <span class="ot">=</span> hyp<span class="sc">$</span>hypDeath</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a><span class="co"># intermediate save data </span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>save <span class="ot">=</span> file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"hyp20002"</span>, <span class="st">"hyp131287"</span>, <span class="st">"hypDeath"</span>)]</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. ICD10 diagnoses (field ID 41202 &amp; 41204)</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a><span class="do">### read in new data; basket 675090 has newer data for these variables </span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41202"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.41204"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>hyp <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(hyp)[<span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41202"</span>, <span class="fu">names</span>(hyp)), <span class="fu">grep</span>(<span class="st">"f.41204"</span>, <span class="fu">names</span>(hyp)))]){</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>  hyp[<span class="fu">which</span>(hyp[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(hyp[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(hyp) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD10 codes of interest to find in field </span></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>hyp_code <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"I10"</span>)</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a><span class="co"># match codes with entries in all variables filtered in 't2d'</span></span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(hyp[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(hyp) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, hyp_code)))</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hypICD41202_4 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(hyp<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hypICD41202_4[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>hypICD41202_4 <span class="ot">=</span> hyp<span class="sc">$</span>hypICD41202_4</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. ICD9 diagnoses (field ID 41203 &amp; 41205)</span></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41203"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.41205"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>hyp <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(hyp)[<span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41203"</span>, <span class="fu">names</span>(hyp)), <span class="fu">grep</span>(<span class="st">"f.41205"</span>, <span class="fu">names</span>(hyp)))]){</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>  hyp[<span class="fu">which</span>(hyp[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(hyp[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(hyp) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD10 codes of interest to find in field </span></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>hyp_code <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"401"</span>,<span class="st">"4010"</span>,<span class="st">"4011"</span>,<span class="st">"4019"</span>)</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a><span class="co"># match codes with entries in all variables filtered in 't2d'</span></span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(hyp[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(hyp) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, hyp_code)))</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hypICD41203_5 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(hyp<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hypICD41203_5[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>hypICD41203_5 <span class="ot">=</span> hyp<span class="sc">$</span>hypICD41203_5</span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a><span class="do">## Combine all hypertension variables </span></span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a><span class="co"># merge with saved columns above</span></span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">merge</span>(file, save, <span class="at">by =</span> <span class="st">"f.eid"</span>)</span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a><span class="co"># keep columns of interest only</span></span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"hyp20002"</span>, <span class="st">"hyp131287"</span>, <span class="st">"hypDeath"</span>, <span class="st">"hypICD41202_4"</span>, <span class="st">"hypICD41203_5"</span>)])</span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those with all missing</span></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(file[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a><span class="co"># identify cases</span></span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>hyp <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a><span class="co"># identify cases</span></span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>hyp[<span class="fu">which</span>(file<span class="sc">$</span>hyp20002 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>hyp131287 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>hypDeath <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>hypICD41202_4 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>hypICD41203_5 <span class="sc">==</span> <span class="dv">1</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a><span class="co"># delete allMissing from controls</span></span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>hyp[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a><span class="co"># make factor</span></span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>hyp <span class="ot">=</span> <span class="fu">as.factor</span>(file<span class="sc">$</span>hyp)</span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a><span class="co">#     0      1 </span></span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a><span class="co"># 277454 204678 </span></span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a><span class="co"># save final variable to a seperate file</span></span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"hyp"</span>)], <span class="at">file =</span> <span class="fu">paste0</span>(out, <span class="st">"/UKB_HypertensionStatus.txt"</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">na =</span> <span class="cn">NA</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="smoking-packyears" class="level2">
<h2 class="anchored" data-anchor-id="smoking-packyears">Smoking (packyears)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># using instance at the time of initial neuroimaging visit</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># also keep "ever smoked" variable to determine zeros in data set</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># no need to consider variable f.20160_2.0 because when it's 0, it's also 0 in packyears </span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.20161_2.0"</span>, <span class="fu">names</span>(file))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>smok <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co"># rename var</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(smok)[<span class="fu">which</span>(<span class="fu">names</span>(smok) <span class="sc">==</span> <span class="st">"f.20161_2.0"</span>)] <span class="ot">=</span> <span class="st">"packyears"</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co"># save variable</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(smok[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"packyears"</span>)], <span class="at">file =</span> <span class="fu">paste0</span>(out, <span class="st">"/UKB_packyears.txt"</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">na =</span> <span class="cn">NA</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="body-mass-index" class="level2">
<h2 class="anchored" data-anchor-id="body-mass-index">Body mass index</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># normal BMI item f.21001.0.0</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># impedance BMI item f.97777.0.0</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.21001_2.0"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.23104_2.0"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>bmi <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Yaghootkar, 2016: We excluded individuals with differences</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;.4.56 SDs between impedance and normal BMI measures where both </span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># variables were available"</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate difference between f.21001.0.0 and f.23104.0.0 for each individual</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>bmi<span class="sc">$</span>BMI_diff <span class="ot">&lt;-</span> bmi<span class="sc">$</span>f.<span class="dv">21001</span>.<span class="fl">0.0</span> <span class="sc">-</span> bmi<span class="sc">$</span>f.<span class="dv">23104</span>.<span class="fl">0.0</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean and SD of the difference between f.21001.0.0 and f.23104.0.0</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>mean_diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(bmi<span class="sc">$</span>BMI_diff,<span class="at">na.rm=</span>T)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>SD_diff <span class="ot">&lt;-</span> <span class="fu">sd</span>(bmi<span class="sc">$</span>BMI_diff,<span class="at">na.rm=</span>T)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean of BMI measures for each individual</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>bmi<span class="sc">$</span>bmi <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(bmi[, <span class="fu">c</span>(<span class="st">"f.21001_2.0"</span>, <span class="st">"f.23104_2.0"</span>)], <span class="at">na.rm =</span> T)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Set BMI_mean to NA for individuals with BMI_diff 4.56 SD from the mean</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>bmi<span class="sc">$</span>bmi[<span class="fu">which</span>(bmi<span class="sc">$</span>BMI_diff <span class="sc">&lt;</span> mean_diff <span class="sc">-</span> (SD_diff<span class="sc">*</span><span class="fl">4.56</span>) <span class="sc">|</span> bmi<span class="sc">$</span>BMI_diff <span class="sc">&gt;</span> mean_diff <span class="sc">+</span> (SD_diff<span class="sc">*</span><span class="fl">4.56</span>))]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co"># save final variable to a seperate file</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(bmi[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"bmi"</span>)], <span class="at">file =</span> <span class="fu">paste0</span>(out, <span class="st">"/UKB_bmi.txt"</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">na =</span> <span class="cn">NA</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="stroke" class="level2">
<h2 class="anchored" data-anchor-id="stroke">Stroke</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># multiple field IDs used to identify stroke</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Self-reported illness: field ID 200002</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Cause of death: field ID 40001</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Source of stroke report: field ID 42007</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. ICd9 diagnoses: field IDs 41203 &amp; 41205</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. ICD10 diagnoses: field IDs 41202 &amp; 41206</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="do">#########################################</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. Self-reported illness (field IDs 20002, 2443, 2986, 2976, 21003) </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">#########################################</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>path<span class="ot">=</span><span class="st">"/UK_Biobank_New/Data/Raw_Data/1027_Refresh_Dec_2022/670476"</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="do">#### field ID 20002 (code 1081 &amp; 1583)</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="do">####################</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.20002"</span>, <span class="fu">names</span>(file))</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>stro <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(stro[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(stro) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 113066</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co"># determine codes of interest to find in field ID 41270</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1081</span>,<span class="dv">1086</span>,<span class="dv">1491</span>,<span class="dv">1583</span>)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co"># match ICDcodes with entries in all f.20002 variables filtered in 't2d'</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(stro[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(stro) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, codes)))</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stro20002 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(stro<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stro20002[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>stro20002 <span class="ot">=</span> stro<span class="sc">$</span>stro20002</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="do">#### field 42007</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a><span class="do">#### Source of report of stroke</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="do">#################################</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.42007"</span>, <span class="fu">names</span>(file))</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>stro <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(stro[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(stro) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a><span class="co"># determine participants with non missing - consider them cases</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>allPresent <span class="ot">=</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(stro[,<span class="fu">which</span>(<span class="fu">names</span>(stro) <span class="sc">!=</span> <span class="st">"f.eid"</span>)]))</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a><span class="co"># consider non-missing a case (but missing doesn't mean they don</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stro42007 <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stro42007[allPresent] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stro42007[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stro42007 <span class="ot">=</span> <span class="fu">as.factor</span>(stro<span class="sc">$</span>stro42007)</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>stro42007 <span class="ot">=</span> stro<span class="sc">$</span>stro42007</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Cause of Death (field ID 40001)</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.40001"</span>, <span class="fu">names</span>(file))</span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>stro <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(stro)[<span class="fu">grep</span>(<span class="st">"f.40001"</span>, <span class="fu">names</span>(stro))]){</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>  stro[<span class="fu">which</span>(stro[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(stro[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(stro) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD10 codes of interest to find in field </span></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"I600"</span>,<span class="st">"I601"</span>,<span class="st">"I602"</span>,<span class="st">"I603"</span>,<span class="st">"I604"</span>,<span class="st">"I605"</span>,<span class="st">"I606"</span>,<span class="st">"I607"</span>,<span class="st">"I608"</span>,<span class="st">"I609"</span>,<span class="st">"I61"</span>,<span class="st">"I610"</span>,<span class="st">"I611"</span>,<span class="st">"I612"</span>,<span class="st">"I613"</span>,<span class="st">"I614"</span>,<span class="st">"I615"</span>,<span class="st">"I616"</span>,<span class="st">"I618"</span>,<span class="st">"I619"</span>,<span class="st">"I63"</span>,<span class="st">"I630"</span>,<span class="st">"I631"</span>,<span class="st">"I632"</span>,<span class="st">"I633"</span>,<span class="st">"I634"</span>,<span class="st">"I635"</span>,<span class="st">"I636"</span>,<span class="st">"I638"</span>,<span class="st">"I639"</span>,<span class="st">"I64"</span>)</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a><span class="co"># match codes with entries in all variables filtered in 'hyp'</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(stro[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(stro) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, codes)))</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stroDeath <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(stro<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stroDeath[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>stroDeath <span class="ot">=</span> stro<span class="sc">$</span>stroDeath</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a><span class="co"># intermediate save</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>save <span class="ot">=</span> file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"stro20002"</span>, <span class="st">"stro42007"</span>, <span class="st">"stroDeath"</span>)]</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. ICD10 diagnoses (field ID 41202 &amp; 41204)</span></span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a><span class="do">### read in new data; basket 675090 has newer data for these variables </span></span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a><span class="co"># file doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41202"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.41204"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>stro <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(stro)[<span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41202"</span>, <span class="fu">names</span>(stro)), <span class="fu">grep</span>(<span class="st">"f.41204"</span>, <span class="fu">names</span>(stro)))]){</span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>  stro[<span class="fu">which</span>(stro[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(stro[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(stro) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD10 codes of interest to find in field </span></span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>ICDcode <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"I600"</span>,<span class="st">"I601"</span>,<span class="st">"I602"</span>,<span class="st">"I603"</span>,<span class="st">"I604"</span>,<span class="st">"I605"</span>,<span class="st">"I606"</span>,<span class="st">"I607"</span>,<span class="st">"I608"</span>,<span class="st">"I609"</span>,<span class="st">"I61"</span>,<span class="st">"I610"</span>,<span class="st">"I611"</span>,<span class="st">"I612"</span>,<span class="st">"I613"</span>,<span class="st">"I614"</span>,<span class="st">"I615"</span>,<span class="st">"I616"</span>,<span class="st">"I618"</span>,<span class="st">"I619"</span>,<span class="st">"I63"</span>,<span class="st">"I630"</span>,<span class="st">"I631"</span>,<span class="st">"I632"</span>,<span class="st">"I633"</span>,<span class="st">"I634"</span>,<span class="st">"I635"</span>,<span class="st">"I636"</span>,<span class="st">"I638"</span>,<span class="st">"I639"</span>,<span class="st">"I64"</span>)</span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a><span class="co"># match codes with entries in all variables filtered in 't2d'</span></span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(stro[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(stro) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, ICDcode)))</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stroICD41202_4 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(stro<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stroICD41202_4[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>stroICD41202_4 <span class="ot">=</span> stro<span class="sc">$</span>stroICD41202_4</span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a><span class="do">## 3. ICD9 diagnoses (field ID 41203 &amp; 41205)</span></span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################</span></span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a><span class="co"># list columns of interest</span></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>id<span class="ot">=</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41203"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.41205"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns of interest</span></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>stro <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a><span class="co"># format "" to be NA</span></span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(stro)[<span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.41203"</span>, <span class="fu">names</span>(stro)), <span class="fu">grep</span>(<span class="st">"f.41205"</span>, <span class="fu">names</span>(stro)))]){</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>  stro[<span class="fu">which</span>(stro[,i] <span class="sc">==</span> <span class="st">""</span>),i] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those who have fully missing data (ecxept their participant ID)</span></span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(stro[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(stro) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a><span class="co"># determine ICD10 codes of interest to find in field </span></span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>codes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"4309"</span>,<span class="st">"4319"</span>,<span class="st">"4340"</span>,<span class="st">"4341"</span>,<span class="st">"4349"</span>,<span class="st">"4369"</span>)</span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a><span class="co"># match codes with entries in all variables filtered in 't2d'</span></span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>countCodes <span class="ot">=</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">sapply</span>(stro[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(stro) <span class="sc">==</span> <span class="st">"f.eid"</span>)], match, codes)))</span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a><span class="co"># if 1 or more entries, consider a case</span></span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stroICD41203_5 <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(stro<span class="sc">$</span>countCodes <span class="sc">&gt;=</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a><span class="co"># delete those with missing IDs</span></span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>stro<span class="sc">$</span>stroICD41203_5[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a><span class="co"># append final column to file</span></span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>stroICD41203_5 <span class="ot">=</span> stro<span class="sc">$</span>stroICD41203_5</span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a><span class="do">## Combine all hypertension variables </span></span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a><span class="do">######################################</span></span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a><span class="co"># merge with saved columns above</span></span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">merge</span>(file, save, <span class="at">by =</span> <span class="st">"f.eid"</span>)</span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a><span class="co"># keep columns of interest only</span></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"stro20002"</span>, <span class="st">"stro42007"</span>, <span class="st">"stroDeath"</span>, <span class="st">"stroICD41202_4"</span>, <span class="st">"stroICD41203_5"</span>)])</span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those with all missing</span></span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(file[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a><span class="co"># identify cases</span></span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>stroke <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a><span class="co"># identify cases</span></span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>stroke[<span class="fu">which</span>(file<span class="sc">$</span>stro20002 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>stro42007 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>stroDeath <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>stroICD41202_4 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a>                file<span class="sc">$</span>stroICD41203_5 <span class="sc">==</span> <span class="dv">1</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a><span class="co"># delete allMissing from controls</span></span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>stroke[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a><span class="co"># make factor</span></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>stroke <span class="ot">=</span> <span class="fu">as.factor</span>(file<span class="sc">$</span>stroke)</span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a><span class="co">#     0      1 </span></span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a><span class="co"># 461708  20197 </span></span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a><span class="co"># save final variable to a seperate file</span></span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"stroke"</span>)], <span class="at">file =</span> <span class="fu">paste0</span>(out, <span class="st">"/UKB_StrokeStatus.txt"</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">na =</span> <span class="cn">NA</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### test overlap with neuroimaging sample</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file that holds neuroimaging IDs</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>IDfile<span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> path, <span class="at">pattern =</span> <span class="st">"AllAvailLong"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>allNeuro <span class="ot">=</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(path, IDfile))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(allNeuro)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"f.eid"</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>stroke <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(out, <span class="st">"/UKB_StrokeStatus.txt"</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># merge with data</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>stroke <span class="ot">=</span> <span class="fu">merge</span>(stroke, allNeuro, <span class="at">by =</span> <span class="st">"f.eid"</span>, <span class="at">all.y=</span>T)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(stroke<span class="sc">$</span>stroke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fried-frailty-definition" class="level2">
<h2 class="anchored" data-anchor-id="fried-frailty-definition">Fried frailty definition</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fried fraitly definition</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Weight loss: 2306</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Exhaustion: 2080</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Weakness: 46,47</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Physical activity: 6164, 1011</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>fileID <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">pat=</span>path,<span class="at">pattern=</span><span class="st">"csv"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># read in file</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(path, <span class="st">"/"</span>, fileID))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># R doesnt like column names that start with number and it doesnt like -</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"f."</span>,<span class="fu">names</span>(file))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(file) <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"-"</span>, <span class="st">"_"</span>, <span class="fu">names</span>(file), <span class="at">fixed =</span> T)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Weight loss: 2306 (neuroimaging visit)</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Coding</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># -3 = Prefer not to say (NA)</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># -1 = Do not know (0)</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 = no weight loss (0)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 = gained weight (0)</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 = lost weight (1)</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"2306_2."</span>, <span class="fu">names</span>(file))</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>sub <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># assign categories as in Jiang et al </span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="sc">-</span><span class="dv">3</span>)] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">0</span>)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">2</span>)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">3</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co"># intermediate save</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>weightLoss <span class="ot">=</span> sub<span class="sc">$</span>f<span class="fl">.2306</span>_2<span class="fl">.0</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Exhaustion: 2080</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Coding in Jiang et al</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co"># -3 = Prefer not to answer (NA)</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="co"># -1 = Don't know (0)</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 = Not at all (0)</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 = Several days (0)</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 = More than half the days (1)</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 = Nearly every day (1)</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.2080_2."</span>, <span class="fu">names</span>(file))</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>sub <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="co"># assign categories as in Jiang et al </span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="sc">-</span><span class="dv">3</span>)] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">1</span>)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">2</span>)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">3</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">4</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a><span class="co"># intermediate save</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>exhaustion <span class="ot">=</span> sub<span class="sc">$</span>f<span class="fl">.2080</span>_2<span class="fl">.0</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Walking speed (924)</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="co"># -7 = None of the above (NA)</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a><span class="co"># -3 = Prefer not to answer (NA)</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 = Slow pace (1)</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 = Steady average pace (0)</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 = Brisk pace (0)</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">grep</span>(<span class="st">"f.924_2."</span>, <span class="fu">names</span>(file))</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>sub <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a><span class="co"># assign categories as in Jiang et al </span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="sc">-</span><span class="dv">7</span>)] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="sc">-</span><span class="dv">3</span>)] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">1</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">2</span>)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span>[<span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">3</span>)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a><span class="co"># intermediate save</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>walkingSpeed <span class="ot">=</span> sub<span class="sc">$</span>f<span class="fl">.924</span>_2<span class="fl">.0</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Weakness (grip strength) field ID average of 46,47</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Cut offs</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Males: </span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a><span class="co"># BMI &lt;= 24 &amp; grip strength &lt;=29</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a><span class="co"># 24.1&lt;=BMI&lt;=28 &amp; grip strength &lt;= 30</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a><span class="co"># BMI &gt; 28 &amp; grip strength &lt;= 32</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Females:</span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a><span class="co"># BMI &lt;= 23 &amp; grip &lt;=17</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a><span class="co"># 23.1&lt;=BMI&lt;=26 &amp; grip &lt;=17.3</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a><span class="co"># 26.1&lt;=BMI &amp; grip &lt;=18</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a><span class="co"># BMI&gt;29 &amp; grip&lt;=21</span></span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns</span></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.46_2."</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.47_2."</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.21001_2.0"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.23104_2.0"</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.31_"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a><span class="co"># subset data</span></span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>sub <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a><span class="co"># get average bmi between two indepdendent measures</span></span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>bmi <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(sub[, <span class="fu">c</span>(<span class="st">"f.21001_2.0"</span>, <span class="st">"f.23104_2.0"</span>)], <span class="at">na.rm =</span> T)</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a><span class="co"># get average grip strength between left and right hand</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>grip <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(sub[, <span class="fu">c</span>(<span class="st">"f.46_2.0"</span>, <span class="st">"f.47_2.0"</span>)], <span class="at">na.rm =</span> T)</span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a><span class="co"># create new variable to hold weakness categories</span></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>weakness <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a><span class="co"># identify participants who have missing bmi and missing grip as we can't determine measures for them</span></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(sub[,<span class="fu">c</span>(<span class="st">"bmi"</span>, <span class="st">"grip"</span>)])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a><span class="co"># assign categories</span></span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a><span class="do">## Males: field ID f.31 is 1 for male</span></span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>males <span class="ot">=</span> <span class="fu">subset</span>(sub, f<span class="fl">.31</span>_0<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>males<span class="sc">$</span>weakness[<span class="fu">which</span>(males<span class="sc">$</span>bmi <span class="sc">&lt;=</span> <span class="dv">24</span> <span class="sc">&amp;</span> males<span class="sc">$</span>grip <span class="sc">&lt;=</span><span class="dv">29</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>males<span class="sc">$</span>weakness[<span class="fu">which</span>(males<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="fl">24.1</span> <span class="sc">&amp;</span> males<span class="sc">$</span>bmi <span class="sc">&lt;=</span> <span class="dv">28</span> <span class="sc">&amp;</span> males<span class="sc">$</span>grip <span class="sc">&lt;=</span> <span class="dv">30</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>males<span class="sc">$</span>weakness[<span class="fu">which</span>(males<span class="sc">$</span>bmi <span class="sc">&gt;</span> <span class="dv">28</span> <span class="sc">&amp;</span> males<span class="sc">$</span>grip <span class="sc">&lt;=</span><span class="dv">32</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a><span class="do">## Females: f.31 is 0 for female</span></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>females <span class="ot">=</span> <span class="fu">subset</span>(sub, f<span class="fl">.31</span>_0<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>females<span class="sc">$</span>weakness[<span class="fu">which</span>(females<span class="sc">$</span>bmi <span class="sc">&lt;=</span> <span class="dv">23</span>  <span class="sc">&amp;</span> females<span class="sc">$</span>grip <span class="sc">&lt;=</span> <span class="dv">17</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>females<span class="sc">$</span>weakness[<span class="fu">which</span>(females<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="fl">23.1</span> <span class="sc">&amp;</span> females<span class="sc">$</span>bmi <span class="sc">&lt;=</span> <span class="dv">26</span> <span class="sc">&amp;</span> females<span class="sc">$</span>grip <span class="sc">&lt;=</span> <span class="fl">17.3</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>females<span class="sc">$</span>weakness[<span class="fu">which</span>(females<span class="sc">$</span>bmi <span class="sc">&gt;=</span> <span class="fl">26.1</span> <span class="sc">&amp;</span> females<span class="sc">$</span>bmi <span class="sc">&lt;=</span> <span class="dv">29</span> <span class="sc">&amp;</span> females<span class="sc">$</span>grip <span class="sc">&lt;=</span> <span class="dv">18</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>females<span class="sc">$</span>weakness[<span class="fu">which</span>(females<span class="sc">$</span>bmi <span class="sc">&gt;</span> <span class="dv">29</span> <span class="sc">&amp;</span> females<span class="sc">$</span>grip <span class="sc">&lt;=</span> <span class="dv">21</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a><span class="co"># combine males and females into 1 dataset</span></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>both <span class="ot">=</span> <span class="fu">rbind</span>(males, females)</span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a><span class="co"># merge weakness variable back with other variables</span></span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>file <span class="ot">=</span> <span class="fu">merge</span>(file, both[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"weakness"</span>)], <span class="at">by =</span> <span class="st">"f.eid"</span>)</span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a><span class="co"># remove participants with all missing info</span></span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>weakness[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Physical activity field ID average of 6164</span></span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 = Walking for pleasure (0)</span></span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 = Other exercises (0)</span></span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 = Strenuous sports (0)</span></span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 = Light DIY (0 = more than once per week, 1 = once per weeks or less)</span></span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 = Heavy DIY (0)</span></span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a><span class="do">## -7 = None of the above (1)</span></span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a><span class="do">## -3 = Prefer not to answer (NA) </span></span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequency of light DIY in the 4 weeks, 1011</span></span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 = Once in the last 4 weeks</span></span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 = 2-3 times in the last4 weeks</span></span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 = Once a week</span></span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 = 2-3 times a week</span></span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 = 4-5 times a week</span></span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 = every day</span></span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a><span class="do">## -1 = do not know </span></span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a><span class="do">## -3 = prefer not to answer </span></span>
<span id="cb13-151"><a href="#cb13-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-152"><a href="#cb13-152" aria-hidden="true" tabindex="-1"></a><span class="co"># select columns</span></span>
<span id="cb13-153"><a href="#cb13-153" aria-hidden="true" tabindex="-1"></a>id <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">names</span>(file) <span class="sc">==</span> <span class="st">"f.eid"</span>)</span>
<span id="cb13-154"><a href="#cb13-154" aria-hidden="true" tabindex="-1"></a>Cols <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">grep</span>(<span class="st">"f.6164_2."</span>, <span class="fu">names</span>(file)), <span class="fu">grep</span>(<span class="st">"f.1011_2"</span>, <span class="fu">names</span>(file)))</span>
<span id="cb13-155"><a href="#cb13-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-156"><a href="#cb13-156" aria-hidden="true" tabindex="-1"></a>sub <span class="ot">=</span> <span class="fu">as.data.frame</span>(file[, <span class="fu">c</span>(..id, ..Cols)])</span>
<span id="cb13-157"><a href="#cb13-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-158"><a href="#cb13-158" aria-hidden="true" tabindex="-1"></a><span class="co"># identify participants who have indicated 'none of the above' (assigned value: 1)</span></span>
<span id="cb13-159"><a href="#cb13-159" aria-hidden="true" tabindex="-1"></a>NoPhysAct <span class="ot">=</span> <span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.6164</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="sc">-</span><span class="dv">7</span>)</span>
<span id="cb13-160"><a href="#cb13-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-161"><a href="#cb13-161" aria-hidden="true" tabindex="-1"></a><span class="co"># we also assign value 1 to people who indicate to do light DIY once per week or less</span></span>
<span id="cb13-162"><a href="#cb13-162" aria-hidden="true" tabindex="-1"></a>NoPhysAct <span class="ot">=</span> <span class="fu">c</span>(NoPhysAct, <span class="fu">which</span>(sub<span class="sc">$</span>f<span class="fl">.6164</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> sub<span class="sc">$</span>f<span class="fl">.1011</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> sub<span class="sc">$</span>f<span class="fl">.6164</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> sub<span class="sc">$</span>f<span class="fl">.1011</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> sub<span class="sc">$</span>f<span class="fl">.6164</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> sub<span class="sc">$</span>f<span class="fl">.1011</span>_2<span class="fl">.0</span> <span class="sc">==</span> <span class="dv">3</span>))</span>
<span id="cb13-163"><a href="#cb13-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-164"><a href="#cb13-164" aria-hidden="true" tabindex="-1"></a><span class="co"># identify participants with all missing data (assigned value: NAs)</span></span>
<span id="cb13-165"><a href="#cb13-165" aria-hidden="true" tabindex="-1"></a>allMissing <span class="ot">=</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(sub[,<span class="fu">grep</span>(<span class="st">"6164"</span>, <span class="fu">names</span>(sub))])) <span class="sc">==</span> <span class="dv">0</span>) </span>
<span id="cb13-166"><a href="#cb13-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-167"><a href="#cb13-167" aria-hidden="true" tabindex="-1"></a><span class="co"># create variable where all participants have assigned value 0</span></span>
<span id="cb13-168"><a href="#cb13-168" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>physicalActiv <span class="ot">=</span> <span class="dv">0</span> </span>
<span id="cb13-169"><a href="#cb13-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-170"><a href="#cb13-170" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those with No Physical Activity</span></span>
<span id="cb13-171"><a href="#cb13-171" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>physicalActiv[NoPhysAct] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a><span class="co"># identify those with all missing</span></span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>physicalActiv[allMissing] <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a><span class="co"># temporary save</span></span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a>file<span class="sc">$</span>physicalActiv <span class="ot">=</span> sub<span class="sc">$</span>physicalActiv</span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a><span class="do">### get overall sumscore</span></span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a>frail <span class="ot">=</span> file[,<span class="fu">c</span>(<span class="st">"f.eid"</span>,<span class="st">"weightLoss"</span>, <span class="st">"exhaustion"</span>, <span class="st">"walkingSpeed"</span>, <span class="st">"weakness"</span>, <span class="st">"physicalActiv"</span>)]</span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a>frail<span class="sc">$</span>FriedFrailty <span class="ot">=</span> <span class="fu">rowSums</span>(frail[,<span class="fu">c</span>(<span class="st">"weightLoss"</span>, <span class="st">"exhaustion"</span>, <span class="st">"walkingSpeed"</span>, <span class="st">"weakness"</span>, <span class="st">"physicalActiv"</span>)], <span class="at">na.rm =</span> F)</span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(frail$FriedFrailty)</span></span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a><span class="co"># save file </span></span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(frail[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"FriedFrailty"</span>)], <span class="at">file =</span> <span class="fu">paste0</span>(out, <span class="st">"/UKB_FriedFrailty.txt"</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">na =</span> <span class="cn">NA</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="brain-age" class="level2">
<h2 class="anchored" data-anchor-id="brain-age">Brain Age</h2>
<p>Brain age was calculated with <a href="github.com/james-cole/brainageR">brainageR v2</a> using the Docker file available on <a href="https://github.com/fprados/brainageR_dockerfile">GitHub</a>, which is performed on each individual NIFTI file and then saved in separate text files.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> docker run <span class="at">--rm</span> <span class="at">-it</span> <span class="at">-v</span> <span class="va">${WD}</span>:/data <span class="at">-w</span> /data docker.io/library/brainimage:latest /bin/bash</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="va">DAT</span><span class="op">=</span><span class="st">"/data/temp"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="va">IDinfo</span><span class="op">=</span><span class="st">"/data/scripts/UKBlong"</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># read in participant IDs</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="va">all</span><span class="op">=</span><span class="va">$(</span><span class="fu">cat</span> <span class="va">${IDinfo}</span>/AllAvailIDs_UKB15112023.txt<span class="va">)</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># run brainageR</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="va">$all</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$i</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> /data/data/UKB_BrainAge/<span class="va">${i}</span>_brain_predicted.age.csv <span class="bu">]</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">then</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        <span class="ex">brainageR</span> <span class="at">-f</span> <span class="va">${DAT}</span>/BrainAge/<span class="va">${i}</span>_T1_orig_defaced.nii <span class="at">-o</span> /data/data/UKB_BrainAge/<span class="va">${i}</span>_brain_predicted.age.csv</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="format-individual-level-data" class="level3">
<h3 class="anchored" data-anchor-id="format-individual-level-data">Format individual-level data</h3>
<p>We found that the average brain age predictions were ~15 years younger than chronological age, and this seems to be a consensus across other research groups who attempted to extract brain age from UKB neuroimaging data. To center brain age around zero, we deducted the sample brain age mean value from each individual value before calculating the brain age gap, which should not affect the interindividual variability were modeling.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># identify csv files saved in Brain Age processing directory</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>files <span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> target, <span class="at">pattern =</span> <span class="st">"_T1_brain_predicted.age.csv"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>files <span class="ot">=</span> <span class="fu">paste0</span>(target, <span class="st">"/"</span>,files)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># object to hold brain age info</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>save <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># cycle through all files and save info</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> files){</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># read in file</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  file <span class="ot">=</span> <span class="fu">read.csv</span>(i, <span class="at">header =</span> T)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># store info in object "save"</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  save <span class="ot">=</span> <span class="fu">rbind</span>(save, file)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># re-name File column to subject ID</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>save<span class="sc">$</span>File <span class="ot">=</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(save<span class="sc">$</span>File, <span class="at">pattern =</span> <span class="st">"_T1_orig_defaced"</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co"># re-name ID column</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(save)[<span class="fu">which</span>(<span class="fu">names</span>(save) <span class="sc">==</span> <span class="st">"File"</span>)] <span class="ot">=</span> <span class="st">"f.eid"</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co"># rename</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>save<span class="sc">$</span>f.eid <span class="ot">=</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(save<span class="sc">$</span>f.eid, <span class="at">pattern =</span> <span class="st">"_orig_defaced"</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(save, <span class="at">file =</span> <span class="st">"/BrainAtrophy/data/UKB_BrainAge_T1_orig_defaced.txt"</span>, <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="merge-all-ukb-phenotypes-into-one-file" class="level2">
<h2 class="anchored" data-anchor-id="merge-all-ukb-phenotypes-into-one-file">Merge all UKB phenotypes into one file</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#list.files(path = wd, pattern = "UKB_")</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># it makes it more straightforward to conduct the following analyses if I merge all phenotypes into one file</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Read all phenotypes in</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Merge them</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Save</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># cognitive ability</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>cog <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_gFactor.txt"</span>))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># dementia</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>dement <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_DementiaStatus.txt"</span>))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>dement<span class="sc">$</span>dement <span class="ot">=</span> <span class="fu">as.factor</span>(dement<span class="sc">$</span>dement)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># APOE</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>APOE <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_APOE_Nov2023.txt"</span>))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(APOE)[<span class="fu">which</span>(<span class="fu">names</span>(APOE) <span class="sc">==</span> <span class="st">"FID"</span>)] <span class="ot">=</span> <span class="st">"f.eid"</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>APOE <span class="ot">=</span> APOE[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"APOEstatus"</span>)]</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>APOE<span class="sc">$</span>APOEstatus[<span class="fu">which</span>(APOE<span class="sc">$</span>APOEstatus <span class="sc">==</span> <span class="st">"e4Allele"</span>)] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>APOE<span class="sc">$</span>APOEstatus[<span class="fu">which</span>(APOE<span class="sc">$</span>APOEstatus <span class="sc">==</span> <span class="st">"NOe4Allele"</span>)] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>APOE<span class="sc">$</span>APOEstatus <span class="ot">=</span> <span class="fu">as.factor</span>(APOE<span class="sc">$</span>APOEstatus)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Frailty</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>frail <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_FriedFrailty.txt"</span>))</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># diabetes</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>diab <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_t2dStatus.txt"</span>))</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>diab<span class="sc">$</span>t2d <span class="ot">=</span> <span class="fu">as.factor</span>(diab<span class="sc">$</span>t2d)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># hyp</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>hyp <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_HypertensionStatus.txt"</span>))</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>hyp<span class="sc">$</span>hyp <span class="ot">=</span> <span class="fu">as.factor</span>(hyp<span class="sc">$</span>hyp)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co"># packyears</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>smok <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_packyears.txt"</span>))</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co"># bmi</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>bmi <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_bmi.txt"</span>))</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co"># brain age</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>BrainAge <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_BrainAge_T1_orig_defaced.txt"</span>))</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="do">## get brain age gap: chronological age minus brain predicted age </span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>age <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_covarGWAS.txt"</span>))</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(age)[<span class="fu">grepl</span>(<span class="st">"FID"</span>, <span class="fu">names</span>(age))] <span class="ot">&lt;-</span> <span class="st">"f.eid"</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>BrainAge <span class="ot">=</span> <span class="fu">merge</span>(BrainAge, age[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"age"</span>)], <span class="at">by =</span> <span class="st">"f.eid"</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>BrainAge<span class="sc">$</span>chronAge <span class="ot">&lt;-</span> BrainAge<span class="sc">$</span>age <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>BrainAge<span class="sc">$</span>BrainAgeGap <span class="ot">&lt;-</span> BrainAge<span class="sc">$</span>chronAge <span class="sc">-</span> BrainAge<span class="sc">$</span>brain.predicted_age</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co"># deducting mean age to be centered around zero</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>BrainAge<span class="sc">$</span>brainAge <span class="ot">&lt;-</span> BrainAge<span class="sc">$</span>BrainAgeGap <span class="sc">-</span> <span class="fu">mean</span>(BrainAge<span class="sc">$</span>BrainAgeGap)</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>BrainAge <span class="ot">=</span> BrainAge[,<span class="fu">c</span>(<span class="st">"f.eid"</span>, <span class="st">"brainAge"</span>)]</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="co"># stroke</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>stroke <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">paste0</span>(wd, <span class="st">"/UKB_StrokeStatus.txt"</span>))</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>stroke<span class="sc">$</span>stroke <span class="ot">=</span> <span class="fu">as.factor</span>(stroke<span class="sc">$</span>stroke)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="co"># merge data</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>DatList <span class="ot">=</span> <span class="fu">list</span>(cog, dement, APOE, frail, diab, hyp, smok, bmi, stroke, BrainAge)</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>UKB_merged <span class="ot">=</span> <span class="fu">Reduce</span>(<span class="cf">function</span>(x,y) <span class="fu">merge</span>(x, y, <span class="at">by =</span> <span class="st">"f.eid"</span>, <span class="at">all =</span> T), DatList)</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="co"># restrict data set to neuroimaging participants </span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>IDfile<span class="ot">=</span> <span class="fu">list.files</span>(<span class="at">path =</span> path, <span class="at">pattern =</span> <span class="st">"AllAvailLong"</span>)</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>allNeuro <span class="ot">=</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(path, IDfile))</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(allNeuro)[<span class="dv">1</span>] <span class="ot">=</span> <span class="st">"f.eid"</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>UKB_merged <span class="ot">=</span> UKB_merged[UKB_merged<span class="sc">$</span>f.eid <span class="sc">%in%</span> allNeuro<span class="sc">$</span>f.eid,]</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a><span class="co"># choose prettier names</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(UKB_merged) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"f.eid"</span>,<span class="st">"cog"</span>,<span class="st">"dementia"</span>,<span class="st">"APOEe4"</span>,<span class="st">"frailty"</span>,<span class="st">"diabetes"</span>,<span class="st">"hypertension"</span>,<span class="st">"packyears"</span>,<span class="st">"BMI"</span>,<span class="st">"stroke"</span>, <span class="st">"brainAge"</span>)</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a><span class="co"># write</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(UKB_merged, <span class="at">file =</span> <span class="fu">paste0</span>(out, <span class="st">"/UKB_allPheno.txt"</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">na =</span> <span class="cn">NA</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>