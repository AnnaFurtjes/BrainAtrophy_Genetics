{
  "hash": "3b35dd49e7538aa118d732745b39d02f",
  "result": {
    "markdown": "---\ntitle: \"Comparing genomic risk loci\"\nformat: \n  html:\n    code-fold: true\nauthor: \"Anna Elisabeth Furtjes\"\ndate: \"06 June 2025\"\noutput: html\ndoi: 10.1101/2024.11.06.622274\n---\n\n\n------------------------------------------------------------------------\n\n\n\n\n\n\n\nTo determine whether the different LBA measures capture similar biology, here I compare FUMA output from the three phenotypes.\n\nThree approaches to test whether associated biology overlaps\n\n  1. Compare locus boundaries\n  \n  2. Compare lead and significant SNPs\n  \n  3. Compare mapped genes\n  \n\n# Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(data.table)\nlibrary(readxl)\nlibrary(stringr)\n```\n:::\n\n\n\n# Read in data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndir = paste0(substr(out, 1, 76), \"Results/FUMA\")\n\n# loci\nresid_loci <- fread(paste0(dir, \"/resid_loci.txt\"))\nratio_loci <- fread(paste0(dir, \"/ratio_loci.txt\"))\ndiff_loci <- fread(paste0(dir, \"/diff_loci.txt\"))\n\n# genes\nresid_genes = fread(paste0(dir,\"/resid_mapped_genes.txt\"))\nratio_genes = fread(paste0(dir,\"/ratio_mapped_genes.txt\"))\ndiff_genes = fread(paste0(dir,\"/diff_mapped_genes.txt\"))\n```\n:::\n\n\n# Compare locus boundaries\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# save results\nNames <- c(\"Resid_locus\", \"overlap_with_ratio\", \"overlap_with_diff\")\nsave <- data.frame(matrix(ncol = length(Names), nrow=length(unique(resid_loci$GenomicLocus))))\nnames(save) <- Names\nsave$Resid_locus <- resid_loci$GenomicLocus\nsave$overlap_with_ratio <- FALSE\nsave$overlap_with_diff <- FALSE\n\n# Comparison with ratio score\nfor(j in save$Resid_locus){\n  # get resid start and end locations\n  start1 <- resid_loci$start[resid_loci$GenomicLocus == j]\n  end1 <- resid_loci$end[resid_loci$GenomicLocus == j]\n  \n  # get list that holds locations for all loci\n  for(i in unique(ratio_loci$GenomicLocus)){\n    # get ratio start and end locations\n    start2 <- ratio_loci$start[ratio_loci$GenomicLocus == i]\n    end2 <- ratio_loci$end[ratio_loci$GenomicLocus == i]\n  \n    # is this locus overlapping with the resid locus in question\n    overlap <- !(end1 < start2 || end2 < start1)\n    \n    # only change status in overlap table if it's true\n    if(overlap == TRUE){\n      save$overlap_with_ratio[save$Resid_locus == j] <- TRUE\n      \n    }\n  }\n\n}\n\n# Comparison with diff score\nfor(j in save$Resid_locus){\n  # get resid start and end locations\n  start1 <- resid_loci$start[resid_loci$GenomicLocus == j]\n  end1 <- resid_loci$end[resid_loci$GenomicLocus == j]\n  \n  # get list that holds locations for all loci\n  for(i in unique(diff_loci$GenomicLocus)){\n    # get diff start and end locations\n    start2 <- diff_loci$start[diff_loci$GenomicLocus == i]\n    end2 <- diff_loci$end[diff_loci$GenomicLocus == i]\n  \n    # is this locus overlapping with the resid locus in question\n    overlap <- !(end1 < start2 || end2 < start1)\n    \n    # only change status in overlap table if it's true\n    if(overlap == TRUE){\n      save$overlap_with_diff[save$Resid_locus == j] <- TRUE\n    }\n  }\n}\n\nprint(paste0(sum(save$overlap_with_ratio), \" of the \", nrow(resid_loci), \" loci picked up by LBA residual overlapped with the loci picked up by LBA ratio.\"))\n\nprint(paste0(sum(save$overlap_with_diff), \" of the \", nrow(resid_loci), \" loci picked up by LBA residual overlapped with the loci picked up by LBA difference.\"))\n```\n:::\n\n\n# Compare lead SNPs\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get lead SNPs for residual score\nresid_leadSNPs <- resid_loci$LeadSNPs\nresid_leadSNPs <- unlist(str_split(resid_leadSNPs, \";\"))\n\n# get lead SNPs for ratio score\nratio_leadSNPs <- ratio_loci$LeadSNPs\nratio_leadSNPs <- unlist(str_split(ratio_leadSNPs, \";\"))\n\n# number of overlapping lead SNPs\nprint(paste0(\"Of the \", length(resid_leadSNPs),\" lead SNPs captured by LBA resid, \", sum(resid_leadSNPs %in% ratio_leadSNPs), \" overlapped with the lead SNPs captured by LBA ratio.\"))\n\n# get lead SNPs for diff score\ndiff_leadSNPs <- diff_loci$LeadSNPs\ndiff_leadSNPs <- unlist(str_split(diff_leadSNPs, \";\"))\n\n# number of overlapping lead SNPs\nprint(paste0(\"Of the \", length(resid_leadSNPs),\" SNPs captured by LBA resid, \", sum(resid_leadSNPs %in% diff_leadSNPs), \" overlapped with the lead SNPs captured by LBA difference\"))\n```\n:::\n\n\n# Compare independent significant SNPs\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get independent SNPs for residual score\nresid_indepSNPs <- resid_loci$IndSigSNPs\nresid_indepSNPs <- unlist(str_split(resid_indepSNPs, \";\"))\n\n# get indep SNPs for ratio score\nratio_indepSNPs <- ratio_loci$IndSigSNPs\nratio_indepSNPs <- unlist(str_split(ratio_indepSNPs, \";\"))\n\n# number of overlapping indep SNPs\nprint(paste0(\"Of the \", length(resid_indepSNPs),\" independent SNPs captured by LBA resid, \", sum(resid_indepSNPs %in% ratio_indepSNPs), \" overlapped with the independent SNPs captured by LBA ratio \", sum(resid_indepSNPs %in% ratio_indepSNPs)/length(resid_indepSNPs)*100, \"%.\"))\n\n# get indep SNPs for diff score\ndiff_indepSNPs <- diff_loci$IndSigSNPs\ndiff_indepSNPs <- unlist(str_split(diff_indepSNPs, \";\"))\n\n# number of overlapping indep SNPs\nprint(paste0(\"Of the \", length(resid_indepSNPs),\" independent SNPs captured by LBA resid, \", sum(resid_indepSNPs %in% diff_indepSNPs), \" overlapped with the independent SNPs captured by LBA difference \", sum(resid_indepSNPs %in% diff_indepSNPs)/length(resid_indepSNPs)*100, \"%.\"))\n```\n:::\n\n\n# Compare mapped genes\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## resid vs ratio score\n# number of genes picked up by both\nsum(resid_genes$ensg %in% ratio_genes$ensg)\n# percentage of resid genes also picked up by ratio\nprint(paste0(sum(resid_genes$ensg %in% ratio_genes$ensg)/ length(resid_genes$ensg)))\n\n## resid vs diff score\n# number of genes picked up by both\nsum(resid_genes$ensg %in% diff_genes$ensg)\n# percentage of resid genes also picked up by ratio\nsum(resid_genes$ensg %in% diff_genes$ensg)/ length(resid_genes$ensg)\n```\n:::\n\n\n# Revisions (second round)\n\nThe reviewer insisted on comparing the residual method with the adjustment method which should mathmatically be identical but produces slightly different results, likely due to the strong associations between TBV and ICV.\n\nHere I am testing whether the adjustment method picked up on different loci to the residual method.\n\n# Read in data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndir = paste0(substr(out, 1, 76), \"Results/FUMA\")\n\n# loci\nresid_loci <- fread(paste0(dir, \"/resid_loci.txt\"))\nadjust_loci <- fread(paste0(dir, \"/adjustment_loci.txt\"))\n\n# genes\nresid_genes = fread(paste0(dir,\"/resid_mapped_genes.txt\"))\nadjust_genes = fread(paste0(dir,\"/adjustment_mapped_genes.txt\"))\n```\n:::\n\n\n# Compare locus boundaries\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# save results\nNames <- c(\"Resid_locus\", \"overlap_with_adjust\")\nsave <- data.frame(matrix(ncol = length(Names), nrow=length(unique(resid_loci$GenomicLocus))))\nnames(save) <- Names\nsave$Resid_locus <- resid_loci$GenomicLocus\nsave$overlap_with_adjust <- FALSE\n\n# Comparison with adjust score\nfor(j in save$Resid_locus){\n  # get resid start and end locations\n  start1 <- resid_loci$start[resid_loci$GenomicLocus == j]\n  end1 <- resid_loci$end[resid_loci$GenomicLocus == j]\n  \n  # get list that holds locations for all loci\n  for(i in unique(adjust_loci$GenomicLocus)){\n    # get adjust start and end locations\n    start2 <- adjust_loci$start[adjust_loci$GenomicLocus == i]\n    end2 <- adjust_loci$end[adjust_loci$GenomicLocus == i]\n  \n    # is this locus overlapping with the resid locus in question\n    overlap <- !(end1 < start2 || end2 < start1)\n    \n    # only change status in overlap table if it's true\n    if(overlap == TRUE){\n      save$overlap_with_adjust[save$Resid_locus == j] <- TRUE\n      \n    }\n  }\n\n}\n\n\nprint(paste0(sum(save$overlap_with_adjust), \" of the \", nrow(resid_loci), \" loci picked up by LBA residual overlapped with the loci picked up by LBA adjust.\"))\n```\n:::\n\n\n# Compare lead SNPs\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get lead SNPs for residual score\nresid_leadSNPs <- resid_loci$LeadSNPs\nresid_leadSNPs <- unlist(str_split(resid_leadSNPs, \";\"))\n\n# get lead SNPs for adjust score\nadjust_leadSNPs <- adjust_loci$LeadSNPs\nadjust_leadSNPs <- unlist(str_split(adjust_leadSNPs, \";\"))\n\n# number of overlapping lead SNPs\nprint(paste0(\"Of the \", length(resid_leadSNPs),\" lead SNPs captured by LBA resid, \", sum(resid_leadSNPs %in% adjust_leadSNPs), \" overlapped with the lead SNPs captured by LBA adjust.\"))\n```\n:::\n\n\n# Compare independent significant SNPs\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get independent SNPs for residual score\nresid_indepSNPs <- resid_loci$IndSigSNPs\nresid_indepSNPs <- unlist(str_split(resid_indepSNPs, \";\"))\n\n# get indep SNPs for adjust score\nadjust_indepSNPs <- adjust_loci$IndSigSNPs\nadjust_indepSNPs <- unlist(str_split(adjust_indepSNPs, \";\"))\n\n# number of overlapping indep SNPs\nprint(paste0(\"Of the \", length(resid_indepSNPs),\" independent SNPs captured by LBA resid, \", sum(resid_indepSNPs %in% adjust_indepSNPs), \" overlapped with the independent SNPs captured by LBA adjust \", sum(resid_indepSNPs %in% adjust_indepSNPs)/length(resid_indepSNPs)*100, \"%.\"))\n```\n:::\n\n\n# Compare mapped genes\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## resid vs ratio score\n# number of genes picked up by both\nsum(resid_genes$ensg %in% adjust_genes$ensg)\n# percentage of resid genes also picked up by adjust\nprint(paste0(sum(resid_genes$ensg %in% adjust_genes$ensg)/ length(resid_genes$ensg)))\n```\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}