{
  "hash": "9ab84c7515eb152c9ab5bceb088f8e2a",
  "result": {
    "markdown": "---\ntitle: \"Age-associated brain shrinkage\"\nformat: \n  html:\n    code-fold: true\nauthor: \"Anna Elisabeth Furtjes\"\ndate: \"14 November 2024\"\noutput: html\ndoi: 10.1101/2024.11.06.622274\n---\n\n\n------------------------------------------------------------------------\n\n\n\n\n\nResults produced by the code below are described in the manuscript under section:\\\n**Measures of LBA indicated age-associated brain shrinkage**.\n\nThe traits used for correlation analysis were derived using code displayed in 'Data preparation': UKB: [neuroimaging](UKB_neuro.html) & [phenotypic](UKB_pheno.html) data..\n\n# Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(data.table)\nlibrary(ggpubr)\nlibrary(patchwork)\n```\n:::\n\n\n# Define function\n\nThis function expects a data set with the variables age, and the three LBA measures. The `ageCut` option takes a vector of different cut-off ages.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuccessivelyReduceAge = function(data = Share, ageCut = ageCut){\n\n  # object to store results\n  storeNames = c(\"Age cut-off value\", \"Cor\", \"p\", \"ci_l\", \"ci_u\", \"Measure\")\n  store = as.data.frame(matrix(nrow = length(ageCut)*3, ncol = length(storeNames)))\n  names(store) = storeNames\n\n    # iterate over each age cut-off and calculate scores\n    for(i in ageCut){\n      # store which age cut off iteration this is\n      loc = which(is.na(store$`Age cut-off value`))[1]\n      store[loc:(loc+2),\"Age cut-off value\"] = i\n\n      # cut sample\n      Youngdata = data[which(data$Age <= i),]\n\n      # calculate correlations\n      ## difference\n      store[loc,\"Cor\"] =\n        with(Youngdata, cor.test(Age, diff))$estimate\n\n      store[loc,\"p\"] =\n        with(Youngdata, cor.test(Age, diff))$p.value\n\n      store[loc,\"ci_l\"] =\n        with(Youngdata, cor.test(Age, diff))$conf.int[1]\n\n      store[loc,\"ci_u\"] =\n        with(Youngdata, cor.test(Age, diff))$conf.int[2]\n\n      store[loc,\"Measure\"] = \"Difference score\"\n\n      ## ratio\n      store[loc+1,\"Cor\"] =\n        with(Youngdata, cor.test(Age, ratio))$estimate\n\n      store[loc+1,\"p\"] =\n        with(Youngdata, cor.test(Age, ratio))$p.value\n\n      store[loc+1,\"ci_l\"] =\n        with(Youngdata, cor.test(Age, ratio))$conf.int[1]\n\n      store[loc+1,\"ci_u\"] =\n        with(Youngdata, cor.test(Age, ratio))$conf.int[2]\n\n      store[loc+1,\"Measure\"] = \"Ratio score\"\n\n      ## residual\n      store[loc+2,\"Cor\"] =\n        with(Youngdata, cor.test(Age, resid))$estimate\n\n      store[loc+2,\"p\"] =\n        with(Youngdata, cor.test(Age, resid))$p.value\n\n      store[loc+2,\"ci_l\"] =\n        with(Youngdata, cor.test(Age, resid))$conf.int[1]\n\n      store[loc+2,\"ci_u\"] =\n        with(Youngdata, cor.test(Age, resid))$conf.int[2]\n\n      store[loc+2,\"Measure\"] = \"Residual score\"\n\n}\n\nreturn(store)\n\n}\n```\n:::\n\n\n# Age correlations (successively reduced age)\n\n## Read in all samples\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# UKB - use cross-sectional data we're also using for GWAS\nUKB = fread(paste0(wd, \"/UKB_CrossNeuroIDP_noOutliers.txt\"))\nage = fread(paste0(wd, \"/UKB_covarGWAS.txt\"))\nUKB = merge(UKB, age[,c(\"FID\", \"age\",\"sex\")], by = \"FID\")\nUKB$Sample = \"UKB\"\nnames(UKB)[which(names(UKB) == \"IID\")] = \"ID\"\nnames(UKB)[which(names(UKB) == \"age\")] = \"Age\"\n\n# restrict to fam file\nfam = fread(paste0(wd, \"/ukb_neuroimaging_brainAtrophy_GWASinput.fam\"))\nUKB = UKB[UKB$FID %in% fam$V1,]\n\n# for more intuitive interpretation, we will flip the associations for resid and ratio sscore\n# larger score = more atrophy\nUKB$resid = UKB$resid*(-1)\nUKB$resid_stand = UKB$resid_stand*(-1)\nUKB$ratio = UKB$ratio*(-1)\nUKB$ratio_stand = UKB$ratio_stand*(-1)\n\n#####################\n## Human Connectome Project\n#####################\n# read in HCP data\nHCP = fread(paste0(wd,\"/unrestricted_hcp_freesurfer.csv\"))\nHCP = HCP[,c(\"Subject\", \"Gender\", \"FS_InterCranial_Vol\", \"FS_BrainSeg_Vol_No_Vent\")]\nnames(HCP) = c(\"ID\", \"Sex\", \"ICV\", \"TBV\")\n\n# add age information\nHCPage = fread(paste0(wd, \"/RESTRICTED_annafurtjes_12_14_2023_4_18_2.csv\"))\nnames(HCPage)[which(names(HCPage) == \"Subject\")] = \"ID\"\nnames(HCPage)[which(names(HCPage) == \"Age_in_Yrs\")] = \"Age\"\nHCP = merge(HCP, HCPage[,c(\"ID\",\"Age\")], by = \"ID\")\n\n# as outlined elsewhere, empirical investigations warrant to use an age cut-off of 31 years in this sample\nHCP = HCP[which(HCP$Age <= 31),]\n\n# convert mm3 estimates to more intuitive cm3 estimates\nHCP$ICV = HCP$ICV/1000\nHCP$TBV = HCP$TBV/1000\n\n# estimate brain atrophy from single MRI scan\nHCP$diff = HCP$ICV - HCP$TBV\nHCP$ratio = HCP$TBV / HCP$ICV\n\n# Quality control: \n#print(paste0(\"Some participants have negative difference scores and ratio scores > 1, which means that their ICV estimate is smaller than their TBV estimate. This must be an error as the skull always surrounds the brain. Those \", sum((HCP$diff < 0)),\" HCP participants were excluded from the data set.\"))\n\ndeletedHCP = sum(HCP$diff < 0)\n# delete those from data \nif(sum(HCP$diff < 0) != 0){HCP=HCP[-which(HCP$diff < 0),]}\n\n# estimate residual model\nmodel <- lm(TBV ~ ICV, data = HCP)\nHCP$resid = as.vector(resid(model, na.rm=T))\n\n# for more intuitive interpretation, we will flip the associations for resid and ratio sscore\n# larger score = more atrophy\nHCP$resid = HCP$resid*(-1)\nHCP$ratio = HCP$ratio*(-1)\n\n# standardise variables\nHCP$diff_stand = as.vector(scale(HCP$diff))\nHCP$ratio_stand = as.vector(scale(HCP$ratio))\nHCP$resid_stand = as.vector(scale(HCP$resid))\n\n\n#####################\n## MRi-Share\n#####################\n# read in MRi-Share\nShare = fread(paste0(wd, \"/MRiShare_global_IDPs_BSAF2021.csv\"))\nShare$TBV = Share$SPM_GM_Volume + Share$SPM_WM_Volume\nShare = Share[,c(\"ID\", \"Age\", \"Sex\", \"eTIV\", \"TBV\")]\nnames(Share) = c(\"ID\", \"Age\", \"Sex\", \"ICV\", \"TBV\")\n\n# convert mm3 estimates to more intuitive cm3 estimates\nShare$ICV = Share$ICV/1000\nShare$TBV = Share$TBV/1000\n\n# estimate brain atrophy from single MRI scan\nShare$diff = Share$ICV - Share$TBV\nShare$ratio = Share$TBV / Share$ICV\n\nmodel <- lm(TBV ~ ICV, data = Share)\nShare$resid = resid(model)\n\n# save intercept value from the regression\nShareintercept = summary(model)$coefficients[1,1]\n\n# for more intuitive interpretation, we will flip the associations for resid and ratio sscore\n# larger score = more atrophy\nShare$resid = Share$resid*(-1)\nShare$ratio = Share$ratio*(-1)\n\n# standardise variables\nShare$diff_stand = as.vector(scale(Share$diff))\nShare$ratio_stand = as.vector(scale(Share$ratio))\nShare$resid_stand = as.vector(scale(Share$resid))\n```\n:::\n\n\n## Calculate age correlations and plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# determine age cut-offs to iterate through\nageCut = seq(from = 22, to = max(Share$Age), by = 1)\n  \n# use function to successively reduce age and determine the correlation between age and atrophy measures\nagePlotShare = successivelyReduceAge(data = Share, ageCut = ageCut)\n\npShare = ggplot(data = agePlotShare)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  #geom_hline(yintercept = 27, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(21, 35), breaks = seq(from = 20, to = 36, by = 2))+\n  scale_x_continuous(limits = c(-0.1, 0.2), breaks = seq(from = -0.5, to = 0.35, by = 0.1))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  ggtitle(paste0(\"MRi-Share (N = \", nrow(Share),\")\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\n# determine age cut-offs to iterate through\nageCut = seq(from = 23, to = max(HCP$Age), by = 1)\n \n# use function to successively reduce age and determine the correlation between age and atrophy measures\nsuccessivelyYoungertHCP = successivelyReduceAge(data = HCP, ageCut = ageCut)\n\npHCP = ggplot(data = successivelyYoungertHCP)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  #geom_hline(yintercept = 29, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(22, 31.5), breaks = seq(from = 20, to = 36, by = 2))+\n  scale_x_continuous(limits = c(-0.2, 0.3), breaks = seq(from = -0.5, to = 0.35, by = 0.1))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  ggtitle(paste0(\"HCP (N = \", nrow(HCP),\")\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\n\n#### UKB\nif(mean(UKB$Age > 100)){UKB$Age = UKB$Age /12}\n# determine age cut-offs to iterate through\nageCut = seq(from = 47, to = max(UKB$Age), by = 1)\n  \n# use function to successively reduce age and determine the correlation between age and atrophy measures\nagePlotUKB= successivelyReduceAge(data = UKB, ageCut = ageCut)\n\npUKB = ggplot(data = agePlotUKB)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(46, 84.5), breaks = seq(from = 44, to = 84, by = 2))+\n  scale_x_continuous(limits = c(-0.5, 0.5), breaks = seq(from = -0.5, to = 0.5, by = 0.2))+\n  ggtitle(paste0(\"UKB (N = \", nrow(UKB),\")\"))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\n# determine age cut-offs to iterate through\nageCut = seq(from = 35, to = max(STRADL$Age), by = 1)\n  \n\n########\n# change direction STRADL\nSTRADL$resid <- STRADL$resid*(-1)\nSTRADL$ratio <- STRADL$ratio*(-1)\n\n# use function to successively reduce age and determine the correlation between age and atrophy measures\nagePlotSTRADL = successivelyReduceAge(data = STRADL, ageCut = ageCut)\n\npSTRADL = ggplot(data = agePlotSTRADL)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  #geom_hline(yintercept = 27, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(34.5, 84.5), breaks = seq(from = 34, to = 84, by = 4))+\n  scale_x_continuous(limits = c(-0.5, 0.5), breaks = seq(from = -0.5, to = 0.5, by = 0.2))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  ggtitle(paste0(\"STRADL (N = \", nrow(STRADL),\")\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\nggsave(\"Fig3_indiv.jpg\", bg = \"white\",plot = newFig2bottoM, width = 30, height = 12, units = \"cm\", dpi = 150)\n```\n:::\n\n\n![](images/Fig3_indiv.jpg){fig-align=\"center\"}\n\n## Repeat for males and females separately\n\nPlots generated below are in Supplementary Plot 13.\n\n### Females\n\n\n::: {.cell}\n\n```{.r .cell-code}\n###### FEMALES\n# determine age cut-offs to iterate through\nageCut = seq(from = 22, to = max(Share$Age), by = 1)\n  \n# use function to successively reduce age and determine the correlation between age and atrophy measures\nagePlotShare = successivelyReduceAge(data = Share[which(Share$Sex == \"F\"),], ageCut = ageCut)\n\npShareF = ggplot(data = agePlotShare)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  #geom_hline(yintercept = 27, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(21, 35), breaks = seq(from = 20, to = 36, by = 2))+\n  scale_x_continuous(limits = c(-0.1, 0.2), breaks = seq(from = -0.5, to = 0.35, by = 0.1))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  ggtitle(paste0(\"MRi-Share\\n(N = \", nrow(Share[which(Share$Sex == \"F\"),]),\" females)\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\n# determine age cut-offs to iterate through\nageCut = seq(from = 23, to = max(HCP$Age), by = 1)\n \n# use function to successively reduce age and determine the correlation between age and atrophy measures\nsuccessivelyYoungertHCP = successivelyReduceAge(data = HCP[which(HCP$Sex == \"F\")], ageCut = ageCut)\n\npHCPF = ggplot(data = successivelyYoungertHCP)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  #geom_hline(yintercept = 29, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(22, 31.5), breaks = seq(from = 20, to = 36, by = 2))+\n  scale_x_continuous(limits = c(-0.3, 0.6), breaks = seq(from = -0.3, to = 0.6, by = 0.2))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  ggtitle(paste0(\"HCP\\n(N = \", nrow(HCP[which(HCP$Sex == \"F\")]),\" females)\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\n\n#### UKB\nif(mean(UKB$Age > 100)){UKB$Age = UKB$Age /12}\n# determine age cut-offs to iterate through\nageCut = seq(from = 47, to = max(UKB$Age), by = 1)\n  \n# use function to successively reduce age and determine the correlation between age and atrophy measures\nagePlotUKB= successivelyReduceAge(data = UKB[UKB$sex == 1,], ageCut = ageCut)\n\npUKBF = ggplot(data = agePlotUKB)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(46, 84.5), breaks = seq(from = 44, to = 84, by = 2))+\n  scale_x_continuous(limits = c(-0.5, 0.5), breaks = seq(from = -0.5, to = 0.5, by = 0.2))+\n  ggtitle(paste0(\"UKB\\n(N = \", nrow(UKB[UKB$sex == 1,]),\" females)\"))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\n# determine age cut-offs to iterate through\nageCut = seq(from = 35, to = max(STRADL$Age), by = 1)\n  \n\n########\n# change direction STRADL\n#STRADL$resid <- STRADL$resid*(-1)\n#STRADL$ratio <- STRADL$ratio*(-1)\n\n# use function to successively reduce age and determine the correlation between age and atrophy measures\nagePlotSTRADL = successivelyReduceAge(data = STRADL[STRADL$Sex == 0,], ageCut = ageCut)\n\npSTRADLF = ggplot(data = agePlotSTRADL)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  #geom_hline(yintercept = 27, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(34.5, 84.5), breaks = seq(from = 34, to = 84, by = 4))+\n  scale_x_continuous(limits = c(-0.5, 0.5), breaks = seq(from = -0.5, to = 0.5, by = 0.2))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  ggtitle(paste0(\"STRADL\\n(N = \", nrow(STRADL[STRADL$Sex == 0,]),\" females)\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\n\nAgecorrFEMALES = ggarrange(pShareF, pHCPF, pUKBF, pSTRADLF, labels = c(\"A\",\"B\",\"C\",\"D\"), common.legend = T, legend = \"bottom\", nrow=1)\nggsave(\"AgeCorr_FEMALES.jpg\", bg = \"white\",plot = AgecorrFEMALES, width = 30, height = 12, units = \"cm\", dpi = 150)\n```\n:::\n\n\n![](images/AgeCorr_FEMALES.jpg){fig-align=\"center\"}\n\n### Males\n\n\n::: {.cell}\n\n```{.r .cell-code}\n###### MALES\n# determine age cut-offs to iterate through\nageCut = seq(from = 22, to = max(Share$Age), by = 1)\n  \n# use function to successively reduce age and determine the correlation between age and atrophy measures\nagePlotShare = successivelyReduceAge(data = Share[which(Share$Sex == \"M\"),], ageCut = ageCut)\n\npShareM = ggplot(data = agePlotShare)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  #geom_hline(yintercept = 27, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(21, 35), breaks = seq(from = 20, to = 36, by = 2))+\n  scale_x_continuous(limits = c(-0.2, 0.2), breaks = seq(from = -0.5, to = 0.35, by = 0.1))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  ggtitle(paste0(\"MRi-Share\\n(N = \", nrow(Share[which(Share$Sex == \"M\"),]),\" males)\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\n# determine age cut-offs to iterate through\nageCut = seq(from = 23, to = max(HCP$Age), by = 1)\n \n# use function to successively reduce age and determine the correlation between age and atrophy measures\nsuccessivelyYoungertHCP = successivelyReduceAge(data = HCP[which(HCP$Sex == \"M\")], ageCut = ageCut)\n\npHCPM = ggplot(data = successivelyYoungertHCP)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  #geom_hline(yintercept = 29, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(22, 31.5), breaks = seq(from = 20, to = 36, by = 2))+\n  scale_x_continuous(limits = c(-0.3, 0.6), breaks = seq(from = -0.3, to = 0.6, by = 0.2))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  ggtitle(paste0(\"HCP\\n(N = \", nrow(HCP[which(HCP$Sex == \"M\")]),\" males)\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\n\n#### UKB\nif(mean(UKB$Age > 100)){UKB$Age = UKB$Age /12}\n# determine age cut-offs to iterate through\nageCut = seq(from = 48, to = max(UKB$Age), by = 1)\n  \n# use function to successively reduce age and determine the correlation between age and atrophy measures\nagePlotUKB= successivelyReduceAge(data = UKB[UKB$sex == 0,], ageCut = ageCut)\n\npUKBM = ggplot(data = agePlotUKB)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(48, 84.5), breaks = seq(from = 44, to = 84, by = 2))+\n  scale_x_continuous(limits = c(-0.55, 0.6), breaks = seq(from = -1, to = 0.9, by = 0.2))+\n  ggtitle(paste0(\"UKB\\n(N = \", nrow(UKB[UKB$sex == 0,]),\" males)\"))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\n# determine age cut-offs to iterate through\nageCut = seq(from = 35, to = max(STRADL$Age), by = 1)\n  \n\n########\n# change direction STRADL\n#STRADL$resid <- STRADL$resid*(-1)\n#STRADL$ratio <- STRADL$ratio*(-1)\n\n# use function to successively reduce age and determine the correlation between age and atrophy measures\nagePlotSTRADL = successivelyReduceAge(data = STRADL[STRADL$Sex == 1,], ageCut = ageCut)\n\npSTRADLM = ggplot(data = agePlotSTRADL)+\n  geom_point(aes(x = Cor, y = `Age cut-off value`, colour = Measure), alpha = 0.5)+\n  geom_errorbar(aes(y = `Age cut-off value`, xmin = ci_l, xmax = ci_u, colour = Measure), alpha = 0.3)+\n  geom_vline(xintercept = 0, color = \"grey\")+\n  #geom_hline(yintercept = 27, color = \"grey\")+\n  xlab(\"Lifetime brain atrophy\\ncorrelation with age\")+\n  ylab(\"Maximum age in subset\\n(cut-off in age in years)\")+\n  scale_y_continuous(limits = c(34.5, 84.5), breaks = seq(from = 34, to = 84, by = 4))+\n  scale_x_continuous(limits = c(-0.7, 0.55), breaks = seq(from = -1, to = 0.55, by = 0.2))+\n  scale_color_manual(values = c(\"#D81B60\",\"#FFC107\",\"#004D40\"))+\n  ggtitle(paste0(\"STRADL\\n(N = \", nrow(STRADL[STRADL$Sex == 1,]),\" males)\"))+\n  theme_bw()+\n  theme(panel.border = element_blank())\n\nAgecorrMALES = ggarrange(pShareM, pHCPM, pUKBM, pSTRADLM, labels = c(\"A\",\"B\",\"C\",\"D\"), common.legend = T, legend = \"bottom\", nrow=1)\nggsave(\"AgeCorr_MALES.jpg\", bg = \"white\",plot = AgecorrMALES, width = 30, height = 12, units = \"cm\", dpi = 150)\n```\n:::\n\n\n![](images/AgeCorr_MALES.jpg){fig-align=\"center\"}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}