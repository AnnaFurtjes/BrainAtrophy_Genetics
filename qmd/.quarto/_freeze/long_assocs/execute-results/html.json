{
  "hash": "54fb534bade8af1235962685704d4369",
  "result": {
    "markdown": "---\ntitle: \"Lifetime brain atrophy is correlated with longitudinally-observed atrophic changes\"\nformat: \n  html:\n    code-fold: true\nauthor: \"Anna Elisabeth Furtjes\"\ndate: \"12 February 2025\"\noutput: html\ndoi: 10.1101/2024.11.06.622274\n---\n\n\n\n\nResults produced by the code below are described in the manuscript under section:\\\n**LBA moderately  captured observed atrophic changes that were longitudinally observed between two MRI scans nine years apart**.\n\nThe outcome traits were derived using code displayed in 'Data preparation': LBC: [neuroimaging](LBC_neuro.html) & [phenotypic](LBC_pheno.html) data; UKB: [neuroimaging](UKB_neuro.html) & [phenotypic](/UKB_pheno.html) data.\nRatio and residual scores were not flipped in these analyses, like they were in the analyses presented in the main manuscript. This does not affect the directions of effects when we were comparing e.g., LBA residual score with longitudinal residual score.\n\n# Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(data.table)\nlibrary(ggpubr)\nlibrary(patchwork)\n```\n:::\n\n\n# Define function\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_heatmap = function(dat = both[,c(\"ICV\",\"TBV\", \"diff\", \"ratio\", \"resid\")], axisNames = c(\"ICV\",\"TBV\",\"Difference\\nscore\",\"Ratio\\nscore\",\"Residual\\nscore\")){\n\n  # define function to obtain lower triangle\n  get_lower_tri<-function(cormat){\n    cormat[upper.tri(cormat)] <- NA\n    return(cormat)\n  }\n\n  # get correlation matrix for both samples together\n  cor = cor(dat, use = \"pairwise.complete.obs\")\n  cor = get_lower_tri(cor)\n  # melt matrix\n  melted = reshape2::melt(cor)\n  # get rounded value\n  melted$value_round = round(melted$value, digit = 2)\n  melted$distance0 = abs(melted$value)\n\n  # plot\n  library(ggplot2)\n\n  p = ggplot(data = melted)+\n    geom_point(aes(x = Var1, y = Var2, shape = value, fill = value, size = distance0), shape = 21, alpha = 0.7, colour = \"white\") +\n    scale_fill_gradient2(low = \"#82A0D8\", high = \"#8DDFCB\", mid = \"white\",\n   midpoint = 0, limit = c(-1,1), space = \"Lab\" ,name=\"Correlation\", guide = \"legend\")+\n    scale_size_continuous(range = c(1, 15), guide = \"none\")+\n    geom_text(aes(Var1, Var2, label = value_round), color = \"black\", size = 4)+\n    xlab(\"\")+\n    ylab(\"\")+\n    #ggtitle(\"Pearson's corelations\")+\n    scale_x_discrete(labels = axisNames)+\n    scale_y_discrete(labels = axisNames)+\n    guides(fill = \"none\")+\n    theme_bw()+\n    theme(panel.border = element_blank())\n\n  return(p)\n}\n```\n:::\n\n\n\n# Pearson's correlations\n\n## LBC\n\nCross-sectional estimates considered from final neuroimaging visit (4th scan, 5th visit). Figures from this analysis are reported in the main paper, and this plot is in Supplementary Plot 4.\n\n\n\n::: {.cell fig.dim='[6,6]'}\n\n```{.r .cell-code}\n# read in LBC data\n## longitudinal\nlong = fread(paste0(out, \"/LBC1936_longTBVWaves2and5.txt\"), select = c(\"lbc36no\",\"TBVdiff_2to5\",\"TBVratio_5to2\",\"TBVresid_2to5\"))\n## cross-sectional\ncross4 = fread(paste0(out, \"/LBC1936_crossNeuroWave4.txt\"), select = c(\"lbc36no\",\"ICV\",\"TBV\", \"diff\", \"ratio\", \"resid\"))\n\n# merge \nLBC = merge(long, cross4, by = \"lbc36no\")\n\n# number of participants\nn = nrow(LBC)\n\n# plot correlations between atrophy measures\np = plot_heatmap(dat = LBC[,c(\"ICV\",\"TBV\", \"diff\", \"ratio\", \"resid\",\"TBVdiff_2to5\",\"TBVratio_5to2\",\"TBVresid_2to5\")], \n                 axisNames = c(\"ICV\",\"TBV\",\"Difference\\nscore\\n(cross)\",\"Ratio\\nscore\\n(cross)\",\"Residual\\nscore\\n(cross)\",\"Difference\\nscore\\n(long)\",\"Ratio\\nscore\\n(long)\",\"Residual\\nscore\\n(long)\"))+\n  ggtitle(paste0(\"LBC Wave 5\\n(N = \",n,\")\"))\np\n```\n\n::: {.cell-output-display}\n![](long_assocs_files/figure-html/unnamed-chunk-2-1.png){width=576}\n:::\n\n```{.r .cell-code}\n#ggsave(paste0(out, \"phenotypic/LBC_corPlot.jpg\"), plot = p, width = 15, height = 15, units = \"cm\", dpi = 300)\n```\n:::\n\n\n\nResidual score:\n\n  - r = 0.36; **p** = 9.9\\times 10^{-10}\n\n\nRatio score:\n\n  - r = 0.29; **p** = 1.4\\times 10^{-6}\n\n\nDifference score:\n\n  - r = 0.3; **p** = 5.6\\times 10^{-7}\n\n\n## UKB\n\nCross-sectional estimates considered from second neuroimaging visit. Figures from this analysis are reported in the main paper, and this plot is in Supplementary Plot 5.\n\n\n::: {.cell fig.dim='[6,6]'}\n\n```{.r .cell-code}\n# read in UKB neuro data\nUKB = fread(paste0(out,\"/UKB_neuroNoLongProcess.txt\"))\n\n# restrict to second neuroimaging visit (i.e., third visit altogether)\nUKB3 = UKB[UKB$wave == 3,]\n\n# later edit: exclude extreme outliers from longitudinal data \nUKB3 <- UKB3[which(UKB3$TBVdiff_2to3_stand < 10),]\nUKB3 <- UKB3[which(UKB3$TBVdiff_2to3_stand > (-10)),]\n\nUKB3 <- UKB3[which(UKB3$TBVratio_3to2_stand < 10),]\nUKB3 <- UKB3[which(UKB3$TBVratio_3to2_stand > (-10)),]\n\nUKB3 <- UKB3[which(UKB3$TBVresid_2to3_stand < 10),]\nUKB3 <- UKB3[which(UKB3$TBVresid_2to3_stand > (-10)),]\n\n# now that more participants were excluded, need to re-calculate the residual score\nmodel <- lm(TBV ~ ICV, data = UKB3)\nUKB3$resid = resid(model)\n\nUKB3$resid_stand <- as.vector(scale(UKB3$resid))\n\n# number of participants\nn = nrow(UKB3)\n\n# plot correlations between atrophy measures\np = plot_heatmap(dat = UKB3[,c(\"ICV\", \"TBV\", \"CSF\", \"diff\", \"ratio\", \"resid\", \"TBVdiff_2to3\", \"TBVratio_3to2\", \"TBVresid_2to3\")], \n                 axisNames = c(\"ICV\", \"TBV\", \"CSF\", \"Difference\\nscore\\n(cross)\", \"Ratio\\nscore\\n(cross)\", \"Residual\\nscore\\n(cross)\", \"Difference\\nscore\\n(long)\", \"Ratio\\nscore\\n(long)\", \"Residual\\nscore\\n(long)\"))+\n  ggtitle(paste0(\"UKB\\nsecond neuroimaging visit\\n(N = \",n,\")\"))\np\n```\n\n::: {.cell-output-display}\n![](long_assocs_files/figure-html/corrUKB-1.png){width=576}\n:::\n\n```{.r .cell-code}\n#ggsave(paste0(out, \"UKB_corPlot.jpg\"), plot = p, width = 15, height = 15, units = \"cm\", dpi = 300)\n```\n:::\n\n\nResidual score:\n\n  - r = 0.29; **p** = 4\\times 10^{-94}\n\n\nRatio score:\n\n  - r = 0.24; **p** = 3\\times 10^{-64}\n\n\nDifference score:\n\n  - r = 0.21; **p** = 5.1\\times 10^{-47}\n\n\n### Repeat heatmap for residual score derived with T1-scaling factor\n\nFigures from this analysis are reported in the main paper, and this plot is in Supplementary Plot 6.\n\n\n::: {.cell fig.dim='[6,6]'}\n\n```{.r .cell-code}\n### make same plot only for cross-sectional measures to compare to resid Scaling factor\nscaling = plot_heatmap(dat = UKB3[,c(\"ICV\", \"TBV\", \"T1ScalingFactor\", \"diff\", \"ratio\", \"resid\", \"residScalingFactor_stand\")], \n                 axisNames = c(\"ICV\", \"TBV\", \"T1 Scaling\\nFactor\", \"Difference\\nscore\\n(cross)\", \"Ratio\\nscore\\n(cross)\", \"Residual\\nscore\\n(cross)\", \"Residual score\\n(scaling factor)\"))+\n  ggtitle(paste0(\"UKB\\nsecond neuroimaging visit\\n(N = \",n,\")\"))\n\n#ggsave(paste0(out, \"phenotypic/UKB_scalingFactor.jpg\"), plot = scaling, width = 14, height = 14, units = \"cm\", dpi = 200)\nscaling\n```\n\n::: {.cell-output-display}\n![](long_assocs_files/figure-html/scaling-1.png){width=576}\n:::\n:::\n",
    "supporting": [
      "long_assocs_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}